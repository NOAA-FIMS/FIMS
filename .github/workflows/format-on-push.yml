name: Format C++ Code

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  format:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout code
      - uses: actions/checkout@v3

      # 2️⃣ Install clang-format
      - name: Install clang-format
        run: sudo apt-get update && sudo apt-get install -y clang-format

      # 3️⃣ Run clang-format on all .cpp and .h files
      - name: Format C++ files
        run: |
          find . -regex '.*\.\(cpp\|hpp\|h\|cc\|cxx\)$' -exec clang-format -i {} \;

      # 4️⃣ Commit changes if formatting modified files
      - name: Commit formatted code
        run: |
          git config user.name "github-actions"
          git config user.email "action@github.com"
          if [[ `git status --porcelain` ]]; then
            git add .
            git commit -m "format: autoformat C++ code"
            git push
          fi
