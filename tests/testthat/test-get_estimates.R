# Instructions ----
#' This file follows the format generated by FIMS:::use_testthat_template().
#' Necessary tests include input and output (IO) correctness [IO
#' correctness], edge-case handling [Edge handling], and built-in errors and
#' warnings [Error handling]. See `?FIMS:::use_testthat_template` for more
#' information. Every test should have a @description tag that takes up just
#' one line, which will be used in the bookdown report of {testthat} results.

# get_estimates ----
## IO correctness ----
test_that("get_estimates() works with correct inputs", {
  # Load the test data from an RDS file containing model fits.
  # List all RDS files in the fixtures directory that match the pattern "fit*_.RDS"
  fit_files <- list.files(
    path = test_path("fixtures"),
    pattern = "^fit.*\\.RDS$",
    full.names = TRUE
  )

  # Define the expected column names for the estimates tibble
  expected_colnames <- c(
    "module", "id", "label", "index", "fleet", "age", "length", "time", 
    "initial", "estimate", "uncertainty", "log_lik", "log_lik_cv",
    "gradient", "estimated"
  )

  # Function to read the RDS file, get estimates, and check column names
  check_estimates_colnames <- function(fit_file) {
    fit_data <- readRDS(fit_file)
    estimates <- get_estimates(fit_data)
    estimates_colnames <- colnames(estimates)
    #' @description Test that get_estimates() returns correct output for the estimates slot.
    expect_equal(
      object = estimates,
      expected = fit_data@estimates
    )
    #' @description Test that get_estimates() returns correct column names for the estimates tibble.
    expect_equal(
      object = estimates_colnames,
      expected = expected_colnames
    )
  }

  # Use purrr::map to apply the function to each file
  result <- purrr::map(fit_files, check_estimates_colnames)
})

## Edge handling ----
test_that("get_estimates() returns correct outputs for edge cases", {
  #' @description Test that get_estimates("invalide_fit") returns an error.
  expect_error(
    object = get_estimates("invalid_fit")
  )
})

## Error handling ----
# No built-in errors or warnings to test for get_estimates().
