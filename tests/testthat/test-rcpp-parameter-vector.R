# Instructions ----
#' This file follows the format generated by FIMS:::use_testthat_template().
#' Necessary tests include input and output (IO) correctness [IO
#' correctness], edge-case handling [Edge handling], and built-in errors and
#' warnings [Error handling]. See `?FIMS:::use_testthat_template` for more
#' information. Every test should have a @description tag, which can span
#' multiple lines, that will be used in the bookdown report of the results from
#' {testthat}.

# rcpp variable vector ----
## Setup ----
# Load or prepare any necessary data for testing

## IO correctness ----
test_that("rcpp ParameterVector works as expected", {
  v_size <- 10
  v1_value <- 1.0
  v2_value <- 2.0

  # Test that default constructor works
  v0 <- methods::new(ParameterVector)
  #' @description Test that default constructor creates a vector of size 1.
  expect_equal(length(v0), 1)
  #' @description Test that `at()` method works.
  expect_equal(v0$at(1)$value, 0)

  v1 <- methods::new(ParameterVector, v_size)
  v1$fill(v1_value)
  for (i in 1:v_size) {
    #' @description Test that `fill()` and `get()` methods work for `ParameterVector`.
    expect_equal(v1$get(i - 1)$value, v1_value)
  }

  v2 <- methods::new(ParameterVector, rep(v2_value, v_size), v_size)
  for (i in 1:v_size) {
    #' @description Test that constructor that takes vector and size works.
    expect_equal(v2$get(i - 1)$value, v2_value)
  }

  v_plus_test <- v1 + v2
  for (i in 1:v_size) {
    #' @description Test that plus operator works.
    expect_equal(v_plus_test$get(i - 1)$value, (v1[i]$value + v2[i]$value))
  }

  v_minus_test <- v1 - v2
  for (i in 1:v_size) {
    #' @description Test minus operator works.
    expect_equal(v_minus_test$get(i - 1)$value, (v1[i]$value - v2[i]$value))
  }

  v_mult_test <- v1 * v2
  for (i in 1:v_size) {
    #' @description Test multiplier operator works.
    expect_equal(v_mult_test$get(i - 1)$value, (v1[i]$value * v2[i]$value))
  }

  v_div_test <- v1 / v2
  for (i in 1:v_size) {
    #' @description Test division operator works.
    expect_equal(v_div_test$get(i - 1)$value, (v1[i]$value / v2[i]$value))
  }

  v_plus_test_scalar <- v2_value + v1
  for (i in 1:v_size) {
    #' @description Test pre scalar plus operator works.
    expect_equal(v_plus_test_scalar$get(i - 1)$value, (v2_value + v1[i]$value))
  }

  v_minus_test_scalar <- v2_value - v1
  for (i in 1:v_size) {
    #' @description Test pre scalar minus operator works.
    expect_equal(v_minus_test_scalar$get(i - 1)$value, (v2_value - v1[i]$value))
  }

  v_mult_test_scalar <- v2_value * v1
  for (i in 1:v_size) {
    #' @description Test pre scalar mult operator works.
    expect_equal(v_mult_test_scalar$get(i - 1)$value, (v2_value * v1[i]$value))
  }

  v_div_test_scalar <- v2_value / v1
  for (i in 1:v_size) {
    #' @description Test pre scalar div operator works.
    expect_equal(v_div_test_scalar$get(i - 1)$value, (v2_value / v1[i]$value))
  }

  v_plus_test_scalar <- v1 + v2_value
  for (i in 1:v_size) {
    #' @description Test post scalar plus operator works.
    expect_equal(v_plus_test_scalar$get(i - 1)$value, (v1[i]$value + v2_value))
  }

  v_minus_test_scalar <- v1 - v2_value
  for (i in 1:v_size) {
    #' @description Test post scalar minus operator works.
    expect_equal(v_minus_test_scalar$get(i - 1)$value, (v1[i]$value - v2_value))
  }

  v_mult_test_scalar <- v1 * v2_value
  for (i in 1:v_size) {
    #' @description Test post scalar mult operator works.
    expect_equal(v_mult_test_scalar$get(i - 1)$value, (v1[i]$value * v2_value))
  }

  v_div_test_scalar <- v1 / v2_value
  for (i in 1:v_size) {
    #' @description Test post scalar div operator works.
    expect_equal(v_div_test_scalar$get(i - 1)$value, (v1[i]$value / v2_value))
  }

  v_acos_test <- acos(v1)
  for (i in 1:v_size) {
    #' @description Test acos function works.
    expect_equal(v_acos_test$get(i - 1)$value, acos(v1_value))
  }

  v_asin_test <- asin(v1)
  for (i in 1:v_size) {
    #' @description Test asin function works.
    expect_equal(v_asin_test$get(i - 1)$value, asin(v1_value))
  }

  v_atan_test <- atan(v1)
  for (i in 1:v_size) {
    #' @description Test atan function works.
    expect_equal(v_atan_test$get(i - 1)$value, atan(v1_value))
  }

  v_cos_test <- cos(v1)
  for (i in 1:v_size) {
    #' @description Test cos function works.
    expect_equal(v_cos_test$get(i - 1)$value, cos(v1_value))
  }

  v_cosh_test <- cosh(v1)
  for (i in 1:v_size) {
    #' @description Test cosh function works.
    expect_equal(v_cosh_test$get(i - 1)$value, cosh(v1_value))
  }

  v_sin_test <- sin(v1)
  for (i in 1:v_size) {
    #' @description Test sin function works.
    expect_equal(v_sin_test$get(i - 1)$value, sin(v1_value))
  }

  v_sinh_test <- sinh(v1)
  for (i in 1:v_size) {
    #' @description Test sinh function works.
    expect_equal(v_sinh_test$get(i - 1)$value, sinh(v1_value))
  }

  v_tan_test <- tan(v1)
  for (i in 1:v_size) {
    #' @description Test tan function works.
    expect_equal(v_tan_test$get(i - 1)$value, tan(v1_value))
  }

  v_tanh_test <- tanh(v1)
  for (i in 1:v_size) {
    #' @description Test tanh function works.
    expect_equal(v_tanh_test$get(i - 1)$value, tanh(v1_value))
  }

  v_exp_test <- exp(v1)
  for (i in 1:v_size) {
    #' @description Test exp function works.
    expect_equal(v_exp_test$get(i - 1)$value, exp(v1_value))
  }

  v_log10_test <- log10(v1)
  for (i in 1:v_size) {
    #' @description Test log10 function works.
    expect_equal(v_log10_test$get(i - 1)$value, log10(v1_value))
  }

  v_sqrt_test <- sqrt(v1)
  for (i in 1:v_size) {
    #' @description Test sqrt function works.
    expect_equal(v_sqrt_test$get(i - 1)$value, sqrt(v1_value))
  }

  v_log_test <- log(v1)
  for (i in 1:v_size) {
    #' @description Test log function works.
    expect_equal(v_log_test$get(i - 1)$value, log(v1_value))
  }

  # test to/from methods
  r_vec <- c(1.0, 2.0, 3.0, 4.0, 5.0)
  v_values_from <- methods::new(ParameterVector, length(r_vec))
  v_values_from$values_from_R_vector(r_vec)
  v_to <- v_values_from$values_to_R_vector()
  #' @description Test from and to methods work.
  expect_equal(length(v_to), length(r_vec))
  for (i in seq_along(r_vec)) {
    expect_equal(v_to[i], r_vec[i])
  }
  # test min
  v_values_from$min_values_from_R_vector(r_vec)
  v_to_min <- v_values_from$min_values_to_R_vector()
  #' @description Test min values to R vector method works.
  expect_equal(length(v_to_min), length(r_vec))
  for (i in seq_along(r_vec)) {
    expect_equal(v_to_min[i], r_vec[i])
  }

  # test max
  v_values_from$max_values_from_R_vector(r_vec)
  v_to_max <- v_values_from$max_values_to_R_vector()
  #' @description Test max values to R vector method works.
  expect_equal(length(v_to_max), length(r_vec))
  for (i in seq_along(r_vec)) {
    expect_equal(v_to_max[i], r_vec[i])
  }

  # test uncertainity
  v_values_from$uncertainty_values_from_R_vector(r_vec)
  v_to_uncertainty <- v_values_from$uncertainty_values_to_R_vector()
  #' @description Test uncertainty values to R vector method works.
  expect_equal(length(v_to_uncertainty), length(r_vec))
  for (i in seq_along(r_vec)) {
    expect_equal(v_to_uncertainty[i], r_vec[i])
  }

  # test final values
  v_values_from$final_values_from_R_vector(r_vec)
  v_to_final <- v_values_from$final_values_to_R_vector()
  #' @description Test final values to R vector method works.
  expect_equal(length(v_to_final), length(r_vec))
  for (i in seq_along(r_vec)) {
    expect_equal(v_to_final[i], r_vec[i])
  }

  # # test estimation type
  est_types <- c("random_effects", "constant", "random_effects", "constant", "random_effects")
  v_values_from$estimation_types_from_R_vector(est_types)
  est_types_from <- v_values_from$estimation_types_to_R_vector()
  #' @description Test estimation types to R vector method works.
  expect_equal(length(est_types_from), length(est_types))
  for (i in seq_along(est_types)) {
    expect_equal(est_types_from[i], est_types[i])
  }





  clear()
})

## Edge handling ----
# No edge cases to test for this function.

## Error handling ----
test_that("ParameterVector returns correct error messages", {
  v0 <- methods::new(ParameterVector)
  #' @description Test that at method returns expected error.
  expect_error(v0$at(10)$value, regexp = "ParameterVector: Index out of range")

  #' @description Test that get method returns expected error.
  expect_error(v0$get(10)$value, regexp = "ParameterVector: Index out of range")

  #' @description Test that ParameterVector returns an error message when trying to make a vector that has dimensions larger than specified in x.
  expect_error(
    methods::new(ParameterVector, 1:3, 5),
    "Error in call to ParameterVector"
  )
})
