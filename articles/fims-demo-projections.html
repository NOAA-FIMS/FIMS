<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simple projections using FIMS • FIMS</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Simple projections using FIMS">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&amp;display=swap" rel="stylesheet">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <img class="navlogo" src="https://noaa-fims.github.io/images/FIMS_logo3.png" width="60" align="left"><a class="navbar-brand me-2" href="../index.html">FIMS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/NOAA-FIMS/FIMS/releases/latest">Latest release</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reports">
<li><a class="dropdown-item" href="../coverage/coverage.html">coverage</a></li>
    <li><a class="dropdown-item" href="../coverage/codecoverage_explanation.html">coverage explained</a></li>
    <li><a class="dropdown-item" href="../testdown/index.html">testdown</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://noaa-fims.github.io/">fims website</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/noaa-fims/fims/" aria-label="GitHub repository for FIMS"><span class="fa fa-brands fa-github fa-lg"></span></a></li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Simple projections using FIMS</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/noaa-fims/fims/blob/main/vignettes/fims-demo-projections.Rmd" class="external-link"><code>vignettes/fims-demo-projections.Rmd</code></a></small>
      <div class="d-none name"><code>fims-demo-projections.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="projections-in-fims">Projections in FIMS<a class="anchor" aria-label="anchor" href="#projections-in-fims"></a>
</h2>
<p>Projections in FIMS can occur during the model-fitting process. That
is, you can extend your time series as many years into the future that
you wish with fixed values of catch or fixed fishing mortality values to
project the population forward in time while estimating parameters. This
dual process during the estimation phase allows you to set priors on
future values and integrate estimated uncertainty into the projection
period.</p>
<p>As we work to set up various inputs and outputs for necessary
management quantities for each region, we encourage you to join the <a href="https://github.com/orgs/NOAA-FIMS/discussions" class="external-link">FIMS Discussion
Board</a> to voice your thoughts about quantities that should be
included. Second, please report bugs in the code to our <a href="https://github.com/NOAA-FIMS/FIMS/Issues" class="external-link">Issues page</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/noaa-fims/fims" class="external-link">FIMS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nmfs-ost/stockplotr" class="external-link">stockplotr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the {stockplotr} theme for all figures</span></span>
<span><span class="co"># ggplot2::theme_set(stockplotr::theme_noaa())</span></span>
<span></span>
<span><span class="co"># clear memory</span></span>
<span><span class="fu">clear</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="without-projections">Without projections<a class="anchor" aria-label="anchor" href="#without-projections"></a>
</h2>
<p>The code below uses the built-in data within FIMS and sets up a
simple catch-at-age configuration object that will work with the data.
These data and configuration objects will be used for to create an
extended data set in the next section. More details about the chunk
below can be found in the <a href="fims-demo.html">introductory
vignette</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bring the package data into your environment</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"data1"</span><span class="op">)</span></span>
<span><span class="co"># Prepare the package data for being used in a FIMS model</span></span>
<span><span class="va">data_4_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FIMSFrame.html">FIMSFrame</a></span><span class="op">(</span><span class="va">data1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create default model configurations based on the data</span></span>
<span><span class="va">default_configurations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_default_configurations.html">create_default_configurations</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_4_model</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="projections">Projections<a class="anchor" aria-label="anchor" href="#projections"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">years_of_projection</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></code></pre></div>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>Below, we show how you can update your data to include 10 years of
projections by extending the terminal year. Second,
<code><a href="../reference/FIMSFrame.html">FIMS::FIMSFrame()</a></code> will fill in missing years of data for
each data type based on your new maximum year in your data. These
missing years use a value of -999 for each data type but users must
provide the uncertainty level associated with the missing data because
by default it will be filled with <code>NA</code>.</p>
<p>In the future, we will integrate more of the process below coded
below into wrapper functions but as of FIMS version 0.8.0 some
manipulation of the data is needed.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add a single row of landings to the original data for the maximum year you</span></span>
<span><span class="co"># want to project to</span></span>
<span><span class="va">data1_with_extra_year</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span></span>
<span>  <span class="va">data1</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"landings"</span>,</span>
<span>  timing <span class="op">=</span> <span class="fu"><a href="../reference/get_FIMSFrame.html">get_end_year</a></span><span class="op">(</span><span class="va">data_4_model</span><span class="op">)</span> <span class="op">+</span> <span class="va">years_of_projection</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"fleet1"</span>,</span>
<span>  value <span class="op">=</span> <span class="op">-</span><span class="fl">999</span>,</span>
<span>  unit <span class="op">=</span> <span class="st">"mt"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">data_4_projections</span> <span class="op">&lt;-</span> <span class="va">data1_with_extra_year</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Make a FIMSFrame object out of this data frame with the extra row to add all</span></span>
<span>  <span class="co"># of the other missing years for each data type</span></span>
<span>  <span class="fu"><a href="../reference/FIMSFrame.html">FIMSFrame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Extract the data object</span></span>
<span>  <span class="fu"><a href="../reference/get_FIMSFrame.html">get_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Change the uncertainty values for each data type these values will</span></span>
<span>  <span class="co"># propagate forward into the log standard deviation values in the model</span></span>
<span>  <span class="co"># specifications</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    uncertainty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>      <span class="va">type</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"landings"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">value</span> <span class="op">==</span> <span class="op">-</span><span class="fl">999</span>,</span>
<span>      <span class="fl">0.00999975</span>,</span>
<span>      <span class="va">uncertainty</span></span>
<span>    <span class="op">)</span>,</span>
<span>    uncertainty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>      <span class="va">type</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"index"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">value</span> <span class="op">==</span> <span class="op">-</span><span class="fl">999</span>,</span>
<span>      <span class="fl">0.19804220</span>,</span>
<span>      <span class="va">uncertainty</span></span>
<span>    <span class="op">)</span>,</span>
<span>    uncertainty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>      <span class="va">type</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age_comp"</span>, <span class="st">"length_comp"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">value</span> <span class="op">==</span> <span class="op">-</span><span class="fl">999</span>,</span>
<span>      <span class="fl">0</span>,</span>
<span>      <span class="va">uncertainty</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Make a FIMSFrame out of the altered data frame</span></span>
<span>  <span class="fu"><a href="../reference/FIMSFrame.html">FIMSFrame</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model">Model<a class="anchor" aria-label="anchor" href="#model"></a>
</h3>
<p>The default configuration from a model without projections can be
used as the default configuration. After the parameter configuration is
created it must be manipulated to alter the default parameters for
things like selectivity, fishing mortality, etc. We believe that it is
easier to alter default configurations rather than creating your own
from scratch. So, much of what is done below for projections was also
done in the <a href="fims-demo.html">introductory vignette</a>.</p>
<p>The major difference below compared to a model without projections is
that the recruitment deviations for the projection period are fixed at
zero. Because the new data object has all years,
<code><a href="../reference/create_default_parameters.html">FIMS::create_default_parameters()</a></code> will ensure that all
time-series parameters, e.g., natural mortality, have the correct
dimensions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Take the default configuration with the new data to create some default</span></span>
<span><span class="co"># parameters that we alter to make the model behave a little better</span></span>
<span><span class="va">parameters_projection</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_default_parameters.html">create_default_parameters</a></span><span class="op">(</span></span>
<span>  configurations <span class="op">=</span> <span class="va">default_configurations</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data_4_projections</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Update log_Fmort initial values for Fleet1</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rows.html" class="external-link">rows_update</a></span><span class="op">(</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>      fleet_name <span class="op">=</span> <span class="st">"fleet1"</span>,</span>
<span>      label <span class="op">=</span> <span class="st">"log_Fmort"</span>,</span>
<span>      time <span class="op">=</span> <span class="fu"><a href="../reference/get_FIMSFrame.html">get_start_year</a></span><span class="op">(</span><span class="va">data_4_projections</span><span class="op">)</span><span class="op">:</span></span>
<span>      <span class="fu"><a href="../reference/get_FIMSFrame.html">get_end_year</a></span><span class="op">(</span><span class="va">data_4_projections</span><span class="op">)</span>,</span>
<span>      value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="fl">0.009459165</span>, <span class="fl">0.027288858</span>, <span class="fl">0.045063639</span>,</span>
<span>        <span class="fl">0.061017825</span>, <span class="fl">0.048600752</span>, <span class="fl">0.087420554</span>,</span>
<span>        <span class="fl">0.088447204</span>, <span class="fl">0.186607929</span>, <span class="fl">0.109008958</span>,</span>
<span>        <span class="fl">0.132704335</span>, <span class="fl">0.150615473</span>, <span class="fl">0.161242955</span>,</span>
<span>        <span class="fl">0.116640187</span>, <span class="fl">0.169346119</span>, <span class="fl">0.180191913</span>,</span>
<span>        <span class="fl">0.161240483</span>, <span class="fl">0.314573212</span>, <span class="fl">0.257247574</span>,</span>
<span>        <span class="fl">0.254887252</span>, <span class="fl">0.251462108</span>, <span class="fl">0.349101406</span>,</span>
<span>        <span class="fl">0.254107720</span>, <span class="fl">0.418478117</span>, <span class="fl">0.345721184</span>,</span>
<span>        <span class="fl">0.343685540</span>, <span class="fl">0.314171227</span>, <span class="fl">0.308026829</span>,</span>
<span>        <span class="fl">0.431745298</span>, <span class="fl">0.328030899</span>, <span class="fl">0.499675368</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.499675368</span>, <span class="va">years_of_projection</span><span class="op">)</span></span>
<span>      <span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fleet_name"</span>, <span class="st">"label"</span>, <span class="st">"time"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Update selectivity parameters and log_q for survey1</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rows.html" class="external-link">rows_update</a></span><span class="op">(</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>      fleet_name <span class="op">=</span> <span class="st">"survey1"</span>,</span>
<span>      label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"inflection_point"</span>, <span class="st">"slope"</span>, <span class="st">"log_q"</span><span class="op">)</span>,</span>
<span>      value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">3.315143e-07</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fleet_name"</span>, <span class="st">"label"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Update log_devs in the Recruitment module (time steps 2-end)</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rows.html" class="external-link">rows_update</a></span><span class="op">(</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>      label <span class="op">=</span> <span class="st">"log_devs"</span>,</span>
<span>      time <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="../reference/get_FIMSFrame.html">get_start_year</a></span><span class="op">(</span><span class="va">data_4_projections</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span></span>
<span>      <span class="fu"><a href="../reference/get_FIMSFrame.html">get_end_year</a></span><span class="op">(</span><span class="va">data_4_projections</span><span class="op">)</span>,</span>
<span>      value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="fl">0.43787763</span>, <span class="op">-</span><span class="fl">0.13299042</span>, <span class="op">-</span><span class="fl">0.43251973</span>, <span class="fl">0.64861200</span>, <span class="fl">0.50640852</span>,</span>
<span>        <span class="op">-</span><span class="fl">0.06958319</span>, <span class="fl">0.30246260</span>, <span class="op">-</span><span class="fl">0.08257384</span>, <span class="fl">0.20740372</span>, <span class="fl">0.15289604</span>,</span>
<span>        <span class="op">-</span><span class="fl">0.21709207</span>, <span class="op">-</span><span class="fl">0.13320626</span>, <span class="fl">0.11225374</span>, <span class="op">-</span><span class="fl">0.10650836</span>, <span class="fl">0.26877132</span>,</span>
<span>        <span class="fl">0.24094126</span>, <span class="op">-</span><span class="fl">0.54480751</span>, <span class="op">-</span><span class="fl">0.23680557</span>, <span class="op">-</span><span class="fl">0.58483386</span>, <span class="fl">0.30122785</span>,</span>
<span>        <span class="fl">0.21930545</span>, <span class="op">-</span><span class="fl">0.22281699</span>, <span class="op">-</span><span class="fl">0.51358369</span>, <span class="fl">0.15740234</span>, <span class="op">-</span><span class="fl">0.53988240</span>,</span>
<span>        <span class="op">-</span><span class="fl">0.19556523</span>, <span class="fl">0.20094360</span>, <span class="fl">0.37248740</span>, <span class="op">-</span><span class="fl">0.07163145</span>,</span>
<span>        <span class="co"># recruitment deviations are fixed at zero for the projections</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">years_of_projection</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"label"</span>, <span class="st">"time"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Fix the projection log recruitment deviations at zero</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rows.html" class="external-link">rows_update</a></span><span class="op">(</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>      label <span class="op">=</span> <span class="st">"log_devs"</span>,</span>
<span>      time <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="../reference/get_FIMSFrame.html">get_end_year</a></span><span class="op">(</span><span class="va">data_4_projections</span><span class="op">)</span> <span class="op">-</span> <span class="va">years_of_projection</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span></span>
<span>      <span class="fu"><a href="../reference/get_FIMSFrame.html">get_end_year</a></span><span class="op">(</span><span class="va">data_4_projections</span><span class="op">)</span>,</span>
<span>      estimation_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"constant"</span>, <span class="va">years_of_projection</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"label"</span>, <span class="st">"time"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Update log_sd for log_devs in the Recruitment module</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rows.html" class="external-link">rows_update</a></span><span class="op">(</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>      module_name <span class="op">=</span> <span class="st">"Recruitment"</span>,</span>
<span>      label <span class="op">=</span> <span class="st">"log_sd"</span>,</span>
<span>      value <span class="op">=</span> <span class="fl">0.4</span></span>
<span>    <span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"module_name"</span>, <span class="st">"label"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Update inflection point and slope parameters in the Maturity module</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rows.html" class="external-link">rows_update</a></span><span class="op">(</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>      module_name <span class="op">=</span> <span class="st">"Maturity"</span>,</span>
<span>      label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"inflection_point"</span>, <span class="st">"slope"</span><span class="op">)</span>,</span>
<span>      value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.25</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"module_name"</span>, <span class="st">"label"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Update log_init_naa values in the Population module</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rows.html" class="external-link">rows_update</a></span><span class="op">(</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>      label <span class="op">=</span> <span class="st">"log_init_naa"</span>,</span>
<span>      age <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,</span>
<span>      value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="fl">13.80944</span>, <span class="fl">13.60690</span>, <span class="fl">13.40217</span>, <span class="fl">13.19525</span>, <span class="fl">12.98692</span>, <span class="fl">12.77791</span>,</span>
<span>        <span class="fl">12.56862</span>, <span class="fl">12.35922</span>, <span class="fl">12.14979</span>, <span class="fl">11.94034</span>, <span class="fl">11.73088</span>, <span class="fl">13.18755</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"label"</span>, <span class="st">"age"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># TODO: Figure out how to add SSB_ratio prior</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-fit">Model fit<a class="anchor" aria-label="anchor" href="#model-fit"></a>
</h3>
<p>Regardless if there are projections or not, the model is fit using
the <code><a href="../reference/fit_fims.html">FIMS::fit_fims()</a></code>, which facilitates that the model
output will be in the same format that users are used to.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">projection_fit</span> <span class="op">&lt;-</span> <span class="va">parameters_projection</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/initialize_fims.html">initialize_fims</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_4_projections</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/fit_fims.html">fit_fims</a></span><span class="op">(</span>optimize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ✔ Starting optimization ...</span></span>
<span><span class="co">## ℹ Restarting optimizer 3 times to improve gradient.</span></span>
<span><span class="co">## ℹ Maximum gradient went from 0.01568 to 0.00186 after 3 steps.</span></span>
<span><span class="co">## ✔ Finished optimization</span></span>
<span><span class="co">## ✔ Finished sdreport</span></span>
<span><span class="co">## ℹ FIMS model version: 0.8.0</span></span>
<span><span class="co">## ℹ Total run time was 2.52628 minutes</span></span>
<span><span class="co">## ℹ Number of parameters: fixed_effects=87, random_effects=0, and total=87</span></span>
<span><span class="co">## ℹ Maximum gradient= 0.00186</span></span>
<span><span class="co">## ℹ Negative log likelihood (NLL):</span></span>
<span><span class="co">## • Marginal NLL= 3166.0503</span></span>
<span><span class="co">## • Total NLL= 3166.0503</span></span>
<span><span class="co">## ℹ Terminal SB= 990.87314</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">clear</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-summaries">Model summaries<a class="anchor" aria-label="anchor" href="#model-summaries"></a>
</h3>
<p>We use {stockplotr} to plot the model results. In the code below, we
pass a single model to <code><a href="https://noaa-fisheries-integrated-toolbox.r-universe.dev/stockplotr/reference/plot_biomass.html" class="external-link">stockplotr::plot_biomass()</a></code> but the
list can contain multiple models, where the start and end year of each
model that is included need not align. Thus, if we had fit the model
without projections we could have plotted that here as well for
comparison.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">stockplotr</span><span class="fu">::</span><span class="fu"><a href="https://noaa-fisheries-integrated-toolbox.r-universe.dev/stockplotr/reference/plot_biomass.html" class="external-link">plot_biomass</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"age"</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_FIMSFit.html">get_estimates</a></span><span class="op">(</span><span class="va">projection_fit</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        uncertainty_label <span class="op">=</span> <span class="st">"se"</span>,</span>
<span>        year <span class="op">=</span> <span class="va">year_i</span>,</span>
<span>        estimate <span class="op">=</span> <span class="va">estimated</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Unknown or uninitialised column: `era`.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in max(dat$year[dat$era == era_name], na.rm = TRUE): no non-missing</span></span>
<span><span class="co">## arguments to max; returning -Inf</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_hline()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_text()`).</span></span></code></pre>
<p><img src="fims-demo-projections_files/figure-html/fit-plot-projections-1.png" class="r-plt" alt="Plot of spawning biomass for projection model." width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kelli F. Johnson, Jon K. T. Brodziak, Kathryn L. Doering, Andrea M. Havron, Ronald Klasky, Peter T. Kuriyama, Christopher M. Legault, Bai Li, Timothy J. Miller, Cole C. Monnahan, Megumi C. Oshima, Kyle W. Shertzer, Christine C. Stawitz, Jane Y. Sullivan, Matthew Supernaw, Ian G. Taylor, Nathan R. Vaughan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
