<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Intro to C++ • FIMS</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Intro to C++">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&amp;display=swap" rel="stylesheet">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <img class="navlogo" src="https://noaa-fims.github.io/images/FIMS_logo3.png" width="60" align="left"><a class="navbar-brand me-2" href="../index.html">FIMS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/NOAA-FIMS/FIMS/releases/latest">Latest release</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reports">
<li><a class="dropdown-item" href="../coverage/coverage.html">coverage</a></li>
    <li><a class="dropdown-item" href="../coverage/codecoverage_explanation.html">coverage explained</a></li>
    <li><a class="dropdown-item" href="../testdown/index.html">testdown</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://noaa-fims.github.io/">fims website</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/noaa-fims/fims/" aria-label="GitHub repository for FIMS"><span class="fa fa-brands fa-github fa-lg"></span></a></li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Intro to C++</h1>
                        <h4 data-toc-skip class="author">Andrea
Havron</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/noaa-fims/fims/blob/main/vignettes/training-intro-cpp.Rmd" class="external-link"><code>vignettes/training-intro-cpp.Rmd</code></a></small>
      <div class="d-none name"><code>training-intro-cpp.Rmd</code></div>
    </div>

    
    
<!--
EP - in general it would be really helpful to have side by side examples of similar things happening in FIMS to whatever basic "hello world" simple type of examples that are in this vignette so that people can immediately see the parallels to the FIMS code and make that connection quickly.
-->
<!-- The section below creates a collpase/expand all button -->
<div id="expand-collapse-buttons" style="margin-bottom: 20px;">
<p><button onclick="expandAll()" class="btn btn-primary">Expand
All</button>
<button onclick="collapseAll()" class="btn btn-secondary">Collapse
All</button></p>
</div>
<script>
function expandAll() {
  const details = document.querySelectorAll('details');
  details.forEach((detail) => {
    detail.setAttribute('open', 'true');
  });
}

function collapseAll() {
  const details = document.querySelectorAll('details');
  details.forEach((detail) => {
    detail.removeAttribute('open');
  });
}
</script><div class="section level2">
<h2 id="what-is-c">What is C++<a class="anchor" aria-label="anchor" href="#what-is-c"></a>
</h2>
<div class="section level3">
<h3 id="definition">Definition<a class="anchor" aria-label="anchor" href="#definition"></a>
</h3>
<p>C++ is currently one of the world’s most popular programming
languages. It was created by <a href="https://en.wikipedia.org/wiki/Bjarne_Stroustrup" class="external-link">Bjarne
Stroustrup</a> as an extension of the C language. The language is ideal
for building and maintaining large-scale software infrastructures. Its
<a href="https://adv-r.hadley.nz/oo.html" class="external-link">object-oriented nature</a>
allows for clear structure, modularity, and code reusability, which
helps manage complexity in large projects such as web browsers,
operating systems, and database engines. C++ is also a strongly typed
language, meaning that variable types must be explicitly defined, which
can help catch errors at compile time and improve code reliability (see
the section below on <a href="#types"><code>C++ types</code></a> for
more information on types).</p>
</div>
<div class="section level3">
<h3 id="why-use-c">Why use C++<a class="anchor" aria-label="anchor" href="#why-use-c"></a>
</h3>
<p>There are thousands of online resources available for learning and
troubleshooting C++, making it accessible for both beginners and
experienced developers. C++ supports object-oriented programming, which
enables you to design software using classes and objects, promoting
encapsulation, inheritance, and polymorphism. Additionally, C++ offers
fine-grained control over system resources and memory management, making
it a preferred choice for high-performance applications and systems
programming.</p>
</div>
</div>
<div class="section level2">
<h2 id="writing-c">Writing C++<a class="anchor" aria-label="anchor" href="#writing-c"></a>
</h2>
<div class="section level3">
<h3 id="basics">Basics<a class="anchor" aria-label="anchor" href="#basics"></a>
</h3>
<ul>
<li>Lines end in semicolons</li>
<li>Everything must be declared first, even functions</li>
<li>Indexing starts at 0, where indexing in R starts at 1</li>
<li>Basic math operators (=,+,-,/,*) operate the same as they do in
R</li>
<li>Code must first be compiled before it is run</li>
</ul>
</div>
<div class="section level3">
<h3 id="types">Types<a class="anchor" aria-label="anchor" href="#types"></a>
</h3>
<!-- This section still needs some ties back to the FIMS code -->
<p>Every variable, function, and expression in C++ must have a type,
which determines the amount of memory allocated and the operations that
can be performed. This explicit nature is why C++ is defined a
<strong><a href="https://www.fluentcpp.com/2017/03/31/how-typed-cpp-is-and-why-it-matters/" class="external-link">strongly
typed language</a></strong>. C++ types are categorized into the
following three main groups: Primitive (built-in), Derived, and
User-Defined.</p>
<p>Primitive types are the basic building blocks in C++, similar to
atomic types in R. They represent single values, are are used directly,
and are the building blocks for more complex types.</p>
<ul>
<li>
<code>bool</code>: Boolean (<code>true</code> or
<code>false</code>), like logical in R but lowercase</li>
<li>
<code>char</code>: A single character or small integer</li>
<li>
<code>int</code>: Integer</li>
<li>
<code>float</code>: Single precision floating-point number, less
precise than numeric in R</li>
<li>
<code>double</code>: Double precision floating-point number, like
numeric in R</li>
<li>
<code>void</code>: No return value from a function</li>
</ul>
<p>Derived types in C++ are built from primitive types.</p>
<ul>
<li>Arrays: Like R vectors but fixed size and type</li>
<li>Pointers: Variables that store memory addresses, similar to
environments or references in R</li>
<li>References: Aliases for existing variables, somewhat like <a href="https://rdatatable.gitlab.io/data.table/articles/datatable-reference-semantics.html" class="external-link">assignment
by reference in R</a>
</li>
</ul>
<p>User-defined types in C++ are custom types created by the
programmer.</p>
<ul>
<li>Structs and Classes: These are similar to lists, data frames, or
S3/S4 objects in R, allowing you to group different types of data and
define custom behaviors and methods.</li>
</ul>
<div class="section level4">
<h4 id="hello-world-example">Hello World example<a class="anchor" aria-label="anchor" href="#hello-world-example"></a>
</h4>
<p>In almost all tutorials, the hello world program will be the first
introduction to writing a C++ program. Here we give two examples, one
where <code>main</code>, i.e., the program name, returns an integer and
a duplicate example (without comments in the code) that does not return
a value. Regardless of what is being returned in either option, they
both print “Hello World!” to the terminal.</p>
<details><summary><strong>Example: Hello World</strong>
</summary><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co"> The include statement allows you to use the iostream library, which includes</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co"> the standard library (std) functions.</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"> `using namespace` allows you to use functions in the library that you specify,</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co"> e.g., std, without specifying their namespace on each instance, e.g., you can</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co"> use `cout` rather than `std::cout`.</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co"> main is the entry point to the program and the function name the int</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co"> declaration before the function name declares the function will return an</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="co"> integer.</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>  <span class="co">/*</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="co">   cout allows you to print a message directly to the screen when the function</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="co">   is called</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="co">  */</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>  cout <span class="op">&lt;&lt;</span> <span class="st">"Hello World!"</span><span class="op">;</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</details><p>If a function should not return anything, then the type declaration
before the function name should be <code>void</code>. The above Hello
World program is re-written below (without comments) to use
<code>void</code> instead of <code>int</code>.</p>
<details><summary><strong>Example: Hello World using <code>void</code></strong>
</summary><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="dt">void</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  cout <span class="op">&lt;&lt;</span> <span class="st">"Hello World!"</span><span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</details>
</div>
<div class="section level4">
<h4 id="add-example">add example<a class="anchor" aria-label="anchor" href="#add-example"></a>
</h4>
<p>The following program does a mathematical computation, taking two
integers as inputs and returning an integer.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="cf">return</span> x <span class="op">+</span> y<span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The program coded above will fail if the inputs are not integers,
which is just one example of why C++ is considered a strongly-typed
language. An additional program is needed to handle doubles as inputs.
Using this version of <code>add</code> will return a floating-point
number. See the <a href="#templates">section below on templated code</a>
for how to avoid having to a function for each type.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="dt">double</span> add<span class="op">(</span><span class="dt">double</span> x<span class="op">,</span> <span class="dt">double</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="cf">return</span> x <span class="op">+</span> y<span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="vectors">Vectors<a class="anchor" aria-label="anchor" href="#vectors"></a>
</h4>
<p>Vectors are a compound type and are available in the standard
library, i.e., <a href="https://cplusplus.com/reference/vector/vector/" class="external-link"><code>std::vector</code></a>.
Compound types are built from primitive types like <code>int</code>. A
vector will be compound integer if the vector is composed of integers,
compound double if the vector is composed of doubles, and so on. The
type of all elements in the vector must be the same and must be declared
when the vector is created, e.g., <code>std::vector&lt;int&gt;</code>.
For example, in FIMS we have a vector of parameter names that we declare
as a vector of strings, e.g.,
<code>std::vector&lt;std::string&gt; parameter_names</code> in <a href="https://github.com/NOAA-FIMS/FIMS/blob/main/inst/include/common/information.hpp" class="external-link"><code>information.hpp</code></a>.</p>
<p><code>std::vector</code> has a number of member functions (see the <a href="training-intro-rcpp.html#rcpp-methods">rcpp methods section in the
Rcpp vignette</a>) that can be used to operate on a vector. Below are a
few member functions of <code>std::vector</code> that are commonly used
or used within the FIMS code, e.g., we use <code>resize</code> quite
often. See the <a href="https://en.cppreference.com/w/cpp/container/vector" class="external-link">documentation
for <code>std::vector</code></a> for the full list of member
functions.</p>
<ul>
<li>
<code>begin</code>: return iterator to beginning</li>
<li>
<code>end</code>: return iterator to end</li>
<li>
<code>size</code>: returns vector size</li>
<li>
<code>resize</code>: changes the vector size</li>
<li>
<code>[]</code>: access element</li>
<li>
<code>front</code>: access first element</li>
<li>
<code>back</code>: access last element</li>
<li>
<code>push_back</code>: append element to end</li>
<li>
<code>pop_back</code>: delete last element</li>
<li>
<code>clear</code>: clear content</li>
</ul>
<p>The code below illustrates how to create a vector and utilize some of
the member functions. Specifically, it initializes a vector, resizes it
to have a length of three, adds elements using a <code>for</code> loop,
uses the member function <code>push.back()</code> to add one additional
element to the end of the vector, and returns a vector of doubles with
the following four elements: <code>1.3 2.6 3.9 8.1</code>.</p>
<details><summary><strong>Example: <code>std::vector</code></strong>
</summary><div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> create_vector<span class="op">()</span> <span class="op">{</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> x<span class="op">;</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  x<span class="op">.</span>resize<span class="op">(</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  x<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1.3</span><span class="op">;</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">1</span><span class="op">;</span> i<span class="op">&lt;</span><span class="dv">3</span><span class="op">;</span> i<span class="op">++){</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>    x<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> x<span class="op">[</span>i<span class="op">-</span><span class="dv">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1.3</span><span class="op">;</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  x<span class="op">.</span>push_back<span class="op">(</span><span class="fl">8.1</span><span class="op">);</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>  <span class="cf">return</span> x<span class="op">;</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</details>
</div>
<div class="section level4">
<h4 id="constants">Constants<a class="anchor" aria-label="anchor" href="#constants"></a>
</h4>
<p>If you do not want a value to change throughout the program, you can
assign it to be a constant. For all constant values, you must first
declare it is going to be a constant and then declare the type.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> MinutesPerHour <span class="op">=</span> <span class="dv">60</span><span class="op">;</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="at">const</span> <span class="dt">double</span> pi <span class="op">=</span> <span class="fl">3.14159</span><span class="op">;</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="templates">Templates<a class="anchor" aria-label="anchor" href="#templates"></a>
</h3>
<p>Because C++ is a strongly typed language (see the section on <a href="#types">C++ types</a>), every function must be declared to return
a single type, e.g., <code>int</code>, <code>float</code>,
<code>double</code>, etc. For example, in the <a href="#add-example">simple addition function</a> that we wrote above, we
had to specify two separate functions with the same name, i.e.,
<code>add</code>, one for adding integers and one for adding
doubles.</p>
<p>It can be tedious and repetitive to write out functions for each
type, and it can lead to more code to maintain and more potential for
bugs. To simplify matters, C++ allows for templated code, which allows
functions to take a generic type, e.g., <code>Type</code>, rather than a
specific type, e.g., <code>int</code>. This is helpful for instances
when the guts of a function are repeated multiple times but the input
and output types differ on each instance.</p>
<p>For example, the code below is a single replacement for the two
<code>add</code> functions in the <a href="#add-example">simple addition
function</a>. In fact, this templated function would also work for
additional types beyond integers and doubles not accounted for in the <a href="#add-example">simple addition function</a>, such as booleans
because true and false values translate into 1s and 0s.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">class</span> Type<span class="op">&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>Type my_add<span class="op">(</span>Type x<span class="op">,</span> Type y<span class="op">){</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="cf">return</span> x <span class="op">+</span> y</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<div class="section level4">
<h4 id="syntax-in-fims">Syntax in FIMS<a class="anchor" aria-label="anchor" href="#syntax-in-fims"></a>
</h4>
<p>In templated code, <code>class</code> is interchangeable with
<code>typename</code>, where <code>typename</code> is seen as a more
modern way the templated code. Additionally, you do not have to use
<code>Type</code> for the name of the <code>typename</code>. You could
use a capital T, or many examples use a capital A, e.g.,
<code>template &lt;typename A&gt;</code> instead of
<code>template &lt;class Type&gt;</code>. Within the FIMS codebase, we
exclusively use <code>class</code> instead of <code>typename</code> and
<code>Type</code> to declare the type parameter name. You can see
several examples of templated code in <a href="https://github.com/NOAA-FIMS/FIMS/blob/main/inst/include/common/fims_math.hpp" class="external-link"><code>fims_math.hpp</code></a>.</p>
<p>{Rcpp} does not support C++ templating so you cannot create templated
code if you plan on compiling it with <code><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html" class="external-link">Rcpp::cppFunction()</a></code>
(see the <a href="training-intro-rcpp.html#writing-cpp-functions">vignette on
{Rcpp}</a> for where it does work). Instead, you have to compile the C++
code using the terminal.</p>
</div>
<div class="section level4">
<h4 id="compiling-directions">Compiling directions<a class="anchor" aria-label="anchor" href="#compiling-directions"></a>
</h4>
<p>The example code for <code>my_add</code> given <a href="#templates">above</a> only provides the function and does not
actually run it. Below, we expand it to include the necessary header
file so the output can be printed the screen within an additional
<code>main</code> program that runs <code>my_add</code> multiple times.
In the example below, main returns the integer zero to signal the end of
the program.</p>
<p>To compile and run the code that we give below you must save it to a
.cpp file, e.g., <code>my_templated_add.cpp</code>, and navigate your
terminal to the directory where the file is saved. Next you will need to
compile the program (see the second code chunk), which will create an
executable that you can then run to see the results of
<code>main</code>. If you are on a Windows computer, <code>g++</code>
will be installed in your rtools directory but it might not be available
in your path, which means you will have to specify the full path to the
executable rather than just the executable name as we do in the
example.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> Type<span class="op">&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  Type my_add<span class="op">(</span>Type x<span class="op">,</span> Type y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">+</span> y<span class="op">;</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(){</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>  <span class="co">//works with integers</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>  <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Type is int: "</span> <span class="op">&lt;&lt;</span> my_add<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>  <span class="co">//works with floats</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>  <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Type is float: "</span> <span class="op">&lt;&lt;</span> my_add<span class="op">(</span><span class="fl">1.2</span><span class="op">,</span> <span class="fl">3.2</span><span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>  <span class="co">//works with doubles</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>  <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="st">"Type is double: "</span> <span class="op">&lt;&lt;</span> my_add<span class="op">(</span><span class="fl">1.52757396774</span><span class="op">,</span> <span class="fl">6.83480375227</span><span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Ensure that you navigate your terminal to where you saved
<code>my_templated_add.cpp</code>, using <code>cd</code>, i.e., change
directory, before you run the following code.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">g++</span> my_templated_add.cpp <span class="at">-o</span> a.exe</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="ex">a.exe</span></span></code></pre></div>
<p>Running the executable results in the following being printed to the
screen.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">Type</span> is int: 3</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="ex">Type</span> in float: 4.4</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="ex">Type</span> is double: 8.36238</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="classes">Classes<a class="anchor" aria-label="anchor" href="#classes"></a>
</h3>
<p>In C++, <a href="https://www.geeksforgeeks.org/c-classes-and-objects/" class="external-link">a class</a>
is a user-defined type that serves as a blueprint for creating objects.
For example, <code>Rcpp::NumericVector</code> is a class within Rcpp
that we talk about a lot in the <a href="training-intro-rcpp.html">Rcpp
introduction vignette</a>. Classes allow for the grouping of related
data (called member variables or attributes) and functions (called
member functions or methods) into a single, cohesive unit. This
encapsulation makes it easier to model real-world entities and manage
complexity in large programs (see <a href="https://cplusplus.com/doc/tutorial/classes/" class="external-link">cplusplus.com</a> for
more details). By defining classes, you can create multiple objects with
the same structure and behavior, enabling code reuse, modularity, and
the use of object-oriented programming principles such as inheritance
and polymorphism.</p>
<p>Within your code, a class must first be defined before it can be
used. Though, memory is only allocated when an instance (object) of the
class is created, this is called instantiation. There are several ways
to create class instances in C++. You can declare an object directly
(e.g., <code>MyClass m;</code> that creates the object <code>m</code>
defined by <code>MyClass</code>) or you can use the <code>new</code>
function to allocate memory dynamically and create a pointer to the
object (e.g., <code>MyClass* m = new MyClass();</code>). In modern C++
and in FIMS, it is common to use shared pointers
(<code>std::shared_ptr</code>) to manage memory automatically and safely
share ownership of objects across different parts of the program. If you
are not yet familiar with pointers or dynamic memory allocation, do not
worry—these concepts are explained in detail in the <a href="#pointers-and-references">Pointers and References section</a>
below.</p>
<p>Once a class instance is instantiated, you can access its members
(variables and functions) using either the dot operator (.) if you have
a regular object that was created directly or the arrow operator (-&gt;)
if you are working with a pointer or a shared pointer. This distinction
is important for interacting with class members and is a fundamental
part of working with objects in C++.</p>
<div class="section level4">
<h4 id="myclass-example">MyClass example<a class="anchor" aria-label="anchor" href="#myclass-example"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="kw">class</span> MyClass<span class="op">{</span> <span class="co">//start of class called MyClass</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="co">//Access specifier: can be private, public, or protected</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="kw">public</span><span class="op">:</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="co">//Data members: variables to be used</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="dt">float</span> a<span class="op">;</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>  <span class="dt">float</span> b<span class="op">;</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>  MyClass<span class="op">(){}</span> <span class="co">//Constructor - automatically called when new object created</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>  <span class="co">//Member functions: Methods to access data members</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>  <span class="dt">float</span> my_add<span class="op">(){</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="op">};</span> <span class="co">//class ends with semicolon</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="instantiate-and-initialize">Instantiate and initialize<a class="anchor" aria-label="anchor" href="#instantiate-and-initialize"></a>
</h4>
<details><summary><strong>Example: Use <code>MyClass</code></strong>
</summary><div class="sourceCode" id="cb12"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="dt">void</span> my_class_add<span class="op">(){</span> <span class="co">//Use void because the main function has no return</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="co">//Create instance of class using a declaration</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  MyClass m1<span class="op">;</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>  <span class="co">//Members can be accessed and initialized using the . command</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>  m1<span class="op">.</span>a <span class="op">=</span> <span class="fl">1.2</span><span class="op">;</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>  m1<span class="op">.</span>b <span class="op">=</span> <span class="fl">2.4</span><span class="op">;</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>  Rcpp<span class="op">::</span>Rcout <span class="op">&lt;&lt;</span> <span class="st">"m1.my_add() = "</span> <span class="op">&lt;&lt;</span> m1<span class="op">.</span>my_add<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>  <span class="co">//Create instance of class using a pointer</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>  MyClass<span class="op">*</span> m2 <span class="op">=</span> <span class="kw">new</span> MyClass<span class="op">();</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>  <span class="co">//Note that the above is equivalent to the following, where the space is</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a>  <span class="co">//located is irrelevant</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a>  <span class="co">//MyClass *m2 = new MyClass();</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a>  <span class="co">//Members can be access using the -&gt; command</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a>  m2<span class="op">-&gt;</span>a <span class="op">=</span> <span class="fl">3.3</span><span class="op">;</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a>  m2<span class="op">-&gt;</span>b <span class="op">=</span> <span class="fl">4.4</span><span class="op">;</span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a>  Rcpp<span class="op">::</span>Rcout <span class="op">&lt;&lt;</span> <span class="st">"m2-&gt;my_add() = "</span> <span class="op">&lt;&lt;</span> m2<span class="op">-&gt;</span>my_add<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a>  <span class="co">//Need to delete memory after use when instantiating with new</span></span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a>  <span class="kw">delete</span> m2<span class="op">;</span></span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a>  <span class="co">//Create instance of class with shared pointer</span></span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a>  <span class="co">//Note the type of the shared pointer is MyClass</span></span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a>  <span class="bu">std::</span>shared_ptr<span class="op">&lt;</span>MyClass<span class="op">&gt;</span> m3 <span class="op">=</span> <span class="bu">std::</span>make_shared<span class="op">&lt;</span>MyClass<span class="op">&gt;();</span></span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a>  <span class="co">//Members can be access using the -&gt; command</span></span>
<span id="cb12-33"><a href="#cb12-33" tabindex="-1"></a>  m3<span class="op">-&gt;</span>a <span class="op">=</span> <span class="fl">4.2</span><span class="op">;</span></span>
<span id="cb12-34"><a href="#cb12-34" tabindex="-1"></a>  m3<span class="op">-&gt;</span>b <span class="op">=</span> <span class="fl">1.7</span><span class="op">;</span></span>
<span id="cb12-35"><a href="#cb12-35" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" tabindex="-1"></a>  Rcpp<span class="op">::</span>Rcout <span class="op">&lt;&lt;</span> <span class="st">"m3-&gt;my_add() = "</span> <span class="op">&lt;&lt;</span> m3<span class="op">-&gt;</span>my_add<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb12-37"><a href="#cb12-37" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</details><p>The previous two code chunks are saved in <a href="https://github.com/NOAA-FIMS/FIMS/blob/main/vignettes/cpp/my_class.cpp" class="external-link"><code>cpp/my_class.cpp</code></a>
along with the necessary <code>include</code> statements. You can
compile the file in an R session using {Rcpp} and call the program
<code>my_class_add()</code>, see the following code:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/sourceCpp.html" class="external-link">sourceCpp</a></span><span class="op">(</span><span class="st">"cpp/my_class.cpp"</span><span class="op">)</span></span>
<span><span class="fu">my_class_add</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## m1.my_add() = 3.6</span></span>
<span><span class="co">## m2-&gt;my_add() = 7.7</span></span>
<span><span class="co">## m3-&gt;my_add() = 5.9</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="inheritance">Inheritance<a class="anchor" aria-label="anchor" href="#inheritance"></a>
</h4>
<p>A new class (child, derived) can inherit members and functions from
an existing class (parent, base), and this is termed inheritance. There
are three types of inheritance,</p>
<pre><code>- **public**: everything that can access the base class can access its public members and functions;
- **protected**: only the derived classes can access the protected members and functions of a base class; and
- **private**: only the base class can access private members and functions of the base class.</code></pre>
<p>The <code>MyClass</code> example uses public inheritance, which is
what is largely used in FIMS. Though, some things in FIMS are declared
as private (see <code>SharedInt</code> in <a href="https://github.com/NOAA-FIMS/FIMS/blob/main/inst/include/interface/rcpp/rcpp_objects/rcpp_shared_primitive.hpp" class="external-link"><code>rcpp_shared_primitive.hpp</code></a>).</p>
<p>When setting up inheritance, it’s best to establish a base class with
behavior shared with all the derived classes. This means that the base
class should contain the data members and functions that are common to
all derived classes so code is not duplicated and can be reused easily.
By centralizing shared functionality in the base class, you make your
code more organized, maintainable, and flexible — any changes to shared
behavior only need to be made in one place, and all derived classes will
automatically inherit those updates. This approach also makes it easier
to extend your code in the future by adding new derived classes that
benefit from the existing shared features.</p>
<!-- need example of inheritence in FIMS -->
<p>To refer to members (variables or functions) of the current object,
<code>this-&gt;</code> is used inside of a class. It is especially
useful in derived classes to clarify that you are accessing a member
inherited from the base class, or to resolve naming conflicts. For
example, if a derived class has a function or variable with the same
name as one in the base class, using <code>this-&gt;</code> makes it
clear you mean the member of the current object. In most cases, you can
access members without <code>this-&gt;</code>, but it can help with code
clarity and is sometimes required for templates or to avoid
ambiguity.</p>
<p>In the code below, we create a base class <code>Shape</code> with two
public members, <code>length</code> and <code>height</code>. Then, we
add derived classes that can inherit from the <code>Shape</code> base
class. Finally, we create a function called
<code>calculate_areas()</code> that determines the area of the
appropriate child class.</p>
<details><summary><strong>Example: Inheritance</strong>
</summary><div class="sourceCode" id="cb16"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="kw">class</span> Shape<span class="op">{</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="dt">double</span> length<span class="op">;</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="dt">double</span> height<span class="op">;</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>Shape<span class="op">(){}</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">//Rectangle is a derived class of Shape</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="kw">class</span> Rectangle <span class="op">:</span> <span class="kw">public</span> Shape<span class="op">{</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>  Rectangle<span class="op">()</span> <span class="op">:</span> Shape<span class="op">()</span> <span class="op">{}</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>  <span class="kw">public</span><span class="op">:</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>  <span class="co">//this-&gt;length: points to length within base class, etc.</span></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a>  <span class="dt">double</span> area<span class="op">(){</span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">-&gt;</span>length <span class="op">*</span> <span class="kw">this</span><span class="op">-&gt;</span>height<span class="op">;</span></span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a><span class="co">//Square is also a derived class of Shape</span></span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a><span class="kw">class</span> Square <span class="op">:</span> <span class="kw">public</span> Shape<span class="op">{</span></span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a>  Square<span class="op">()</span> <span class="op">:</span> Shape<span class="op">()</span> <span class="op">{}</span></span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" tabindex="-1"></a>  <span class="kw">public</span><span class="op">:</span></span>
<span id="cb16-29"><a href="#cb16-29" tabindex="-1"></a>  <span class="dt">double</span> area<span class="op">(){</span></span>
<span id="cb16-30"><a href="#cb16-30" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">-&gt;</span>length <span class="op">*</span> <span class="kw">this</span><span class="op">-&gt;</span>length<span class="op">;</span></span>
<span id="cb16-31"><a href="#cb16-31" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb16-32"><a href="#cb16-32" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb16-33"><a href="#cb16-33" tabindex="-1"></a></span>
<span id="cb16-34"><a href="#cb16-34" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb16-35"><a href="#cb16-35" tabindex="-1"></a><span class="dt">double</span> calculate_areas<span class="op">(</span><span class="bu">std::</span>string shape<span class="op">,</span> <span class="dt">double</span> length<span class="op">,</span> <span class="dt">double</span> width <span class="op">=</span> <span class="dv">0</span><span class="op">){</span></span>
<span id="cb16-36"><a href="#cb16-36" tabindex="-1"></a></span>
<span id="cb16-37"><a href="#cb16-37" tabindex="-1"></a>  <span class="dt">double</span> out <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb16-38"><a href="#cb16-38" tabindex="-1"></a></span>
<span id="cb16-39"><a href="#cb16-39" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>shape <span class="op">==</span> <span class="st">"rectangle"</span><span class="op">){</span></span>
<span id="cb16-40"><a href="#cb16-40" tabindex="-1"></a>      Rectangle rect<span class="op">;</span></span>
<span id="cb16-41"><a href="#cb16-41" tabindex="-1"></a>      rect<span class="op">.</span>length <span class="op">=</span> length<span class="op">;</span></span>
<span id="cb16-42"><a href="#cb16-42" tabindex="-1"></a>      rect<span class="op">.</span>width <span class="op">=</span> width<span class="op">;</span></span>
<span id="cb16-43"><a href="#cb16-43" tabindex="-1"></a>      out <span class="op">=</span> rect<span class="op">.</span>area<span class="op">();</span></span>
<span id="cb16-44"><a href="#cb16-44" tabindex="-1"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>shape <span class="op">==</span> <span class="st">"square"</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-45"><a href="#cb16-45" tabindex="-1"></a>      Square sq<span class="op">;</span></span>
<span id="cb16-46"><a href="#cb16-46" tabindex="-1"></a>      sq<span class="op">.</span>length <span class="op">=</span> length<span class="op">;</span></span>
<span id="cb16-47"><a href="#cb16-47" tabindex="-1"></a>      out <span class="op">=</span> sq<span class="op">.</span>area<span class="op">();</span></span>
<span id="cb16-48"><a href="#cb16-48" tabindex="-1"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb16-49"><a href="#cb16-49" tabindex="-1"></a>      Rcpp<span class="op">::</span>Rcout <span class="op">&lt;&lt;</span> <span class="st">"Invalid shape"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb16-50"><a href="#cb16-50" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb16-51"><a href="#cb16-51" tabindex="-1"></a>  <span class="cf">return</span> out<span class="op">;</span></span>
<span id="cb16-52"><a href="#cb16-52" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</details><p>The previous code and the appropriate include statements are combined
into <a href="https://github.com/NOAA-FIMS/FIMS/blob/main/vignettes/cpp/my_inheritance.cpp" class="external-link"><code>cpp/my_inheritance.cpp</code></a>
and can be run from R using <code><a href="https://rdrr.io/pkg/Rcpp/man/sourceCpp.html" class="external-link">Rcpp::sourceCpp()</a></code>, see
below.</p>
<details><summary><strong>Example: Run inheritance example from R</strong>
</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/sourceCpp.html" class="external-link">sourceCpp</a></span><span class="op">(</span><span class="st">"cpp/my_inheritance.cpp"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">calculate_areas</span><span class="op">(</span><span class="st">"rectangle"</span>, <span class="fl">6</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 24</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">calculate_areas</span><span class="op">(</span><span class="st">"square"</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">calculate_areas</span><span class="op">(</span><span class="st">"triangle"</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Invalid shape</span></span></code></pre>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
</details>
</div>
<div class="section level4">
<h4 id="polymorphism">Polymorphism<a class="anchor" aria-label="anchor" href="#polymorphism"></a>
</h4>
<p>We saw how derived classes can inherit from base classes. This
example resulted in code that required <code>if ()</code> statements to
calculate a function for the different classes. Polymorphism can be used
instead to specify different behaviors for each child class to avoid
conditional statements in the code, which are hard to maintain and
extend. Polymorphism is used when a function or operator works
differently when used in different context and works when classes
inherit from each other resulting in a single action or function that
produces different results based on the derived class.</p>
<p>To set up polymorphism in your code you will need to use a
<code>virtual</code> function that is overridden at run time. Thus, we
will set up the base class as before but this time the shared object is
a function called <code>area()</code>. Note that the area function is
proceeded by <code>virtual</code> and set to equal 0. This is done to
specify that <code>area</code> is a function being overwritten by
functions from the child classes. Then, we specify <code>virtual</code>
functions in each child class with the same name, e.g.,
<code>area</code>, to overwrite the <code>area</code> function in the
base class. Finally, the classes have to be exposed to R using
<code>Rcpp::RCPP_MODULE()</code>. See the <a href="training-intro-rcpp.html">vignette on Rcpp</a> for a refresher on
Rcpp modules.</p>
<details><summary><strong>Example: Polymorphism</strong>
</summary><div class="sourceCode" id="cb24"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="kw">class</span> Shape <span class="op">{</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>  <span class="kw">public</span><span class="op">:</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>    <span class="co">//constructor</span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>    Shape<span class="op">()</span> <span class="op">{}</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>    <span class="kw">virtual</span> <span class="op">~</span>Shape<span class="op">()</span> <span class="op">{}</span></span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>    <span class="co">// Virtual function to calculate area</span></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>    <span class="kw">virtual</span> <span class="dt">double</span> area<span class="op">()</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a><span class="kw">class</span> Circle <span class="op">:</span> <span class="kw">public</span> Shape <span class="op">{</span></span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a>  <span class="dt">double</span> radius<span class="op">;</span></span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a>  <span class="kw">public</span><span class="op">:</span></span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a>    Circle<span class="op">(</span><span class="dt">double</span> r<span class="op">)</span> <span class="op">:</span> Shape<span class="op">(){</span></span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a>      radius <span class="op">=</span> r<span class="op">;</span></span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb24-20"><a href="#cb24-20" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" tabindex="-1"></a>  <span class="co">// Override area() for Circle</span></span>
<span id="cb24-22"><a href="#cb24-22" tabindex="-1"></a>  <span class="kw">virtual</span> <span class="dt">double</span> area<span class="op">()</span> <span class="op">{</span></span>
<span id="cb24-23"><a href="#cb24-23" tabindex="-1"></a>    <span class="cf">return</span> M_PI <span class="op">*</span> radius <span class="op">*</span> radius<span class="op">;</span></span>
<span id="cb24-24"><a href="#cb24-24" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb24-25"><a href="#cb24-25" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb24-26"><a href="#cb24-26" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" tabindex="-1"></a><span class="kw">class</span> Rectangle <span class="op">:</span> <span class="kw">public</span> Shape <span class="op">{</span></span>
<span id="cb24-28"><a href="#cb24-28" tabindex="-1"></a>  <span class="kw">private</span><span class="op">:</span></span>
<span id="cb24-29"><a href="#cb24-29" tabindex="-1"></a>    <span class="dt">double</span> length<span class="op">,</span> height<span class="op">;</span></span>
<span id="cb24-30"><a href="#cb24-30" tabindex="-1"></a></span>
<span id="cb24-31"><a href="#cb24-31" tabindex="-1"></a>  <span class="kw">public</span><span class="op">:</span></span>
<span id="cb24-32"><a href="#cb24-32" tabindex="-1"></a>    Rectangle<span class="op">(</span><span class="dt">double</span> l<span class="op">,</span> <span class="dt">double</span> h<span class="op">)</span> <span class="op">:</span> Shape<span class="op">(){</span></span>
<span id="cb24-33"><a href="#cb24-33" tabindex="-1"></a>      length <span class="op">=</span> l<span class="op">;</span></span>
<span id="cb24-34"><a href="#cb24-34" tabindex="-1"></a>      height <span class="op">=</span> h<span class="op">;</span></span>
<span id="cb24-35"><a href="#cb24-35" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb24-36"><a href="#cb24-36" tabindex="-1"></a></span>
<span id="cb24-37"><a href="#cb24-37" tabindex="-1"></a>  <span class="co">// Override area() for Rectangle</span></span>
<span id="cb24-38"><a href="#cb24-38" tabindex="-1"></a>  <span class="kw">virtual</span> <span class="dt">double</span> area<span class="op">()</span>  <span class="op">{</span></span>
<span id="cb24-39"><a href="#cb24-39" tabindex="-1"></a>    <span class="cf">return</span> length <span class="op">*</span> height<span class="op">;</span></span>
<span id="cb24-40"><a href="#cb24-40" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb24-41"><a href="#cb24-41" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb24-42"><a href="#cb24-42" tabindex="-1"></a></span>
<span id="cb24-43"><a href="#cb24-43" tabindex="-1"></a>RCPP_MODULE<span class="op">(</span>shape<span class="op">)</span> <span class="op">{</span></span>
<span id="cb24-44"><a href="#cb24-44" tabindex="-1"></a>  Rcpp<span class="op">::</span><span class="va">class_</span><span class="op">&lt;</span>Shape<span class="op">&gt;(</span><span class="st">"Shape"</span><span class="op">)</span></span>
<span id="cb24-45"><a href="#cb24-45" tabindex="-1"></a>  <span class="op">.</span>method<span class="op">(</span><span class="st">"area"</span><span class="op">,</span> <span class="op">&amp;</span>Shape<span class="op">::</span>area<span class="op">);</span></span>
<span id="cb24-46"><a href="#cb24-46" tabindex="-1"></a></span>
<span id="cb24-47"><a href="#cb24-47" tabindex="-1"></a>  Rcpp<span class="op">::</span><span class="va">class_</span><span class="op">&lt;</span>Circle<span class="op">&gt;(</span><span class="st">"Circle"</span><span class="op">)</span></span>
<span id="cb24-48"><a href="#cb24-48" tabindex="-1"></a>    <span class="op">.</span>derives<span class="op">&lt;</span>Shape<span class="op">&gt;(</span><span class="st">"Shape"</span><span class="op">)</span></span>
<span id="cb24-49"><a href="#cb24-49" tabindex="-1"></a>    <span class="op">.</span>constructor<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;();</span></span>
<span id="cb24-50"><a href="#cb24-50" tabindex="-1"></a></span>
<span id="cb24-51"><a href="#cb24-51" tabindex="-1"></a>  Rcpp<span class="op">::</span><span class="va">class_</span><span class="op">&lt;</span>Rectangle<span class="op">&gt;(</span><span class="st">"Rectangle"</span><span class="op">)</span></span>
<span id="cb24-52"><a href="#cb24-52" tabindex="-1"></a>    <span class="op">.</span>derives<span class="op">&lt;</span>Shape<span class="op">&gt;(</span><span class="st">"Shape"</span><span class="op">)</span></span>
<span id="cb24-53"><a href="#cb24-53" tabindex="-1"></a>    <span class="op">.</span>constructor<span class="op">&lt;</span><span class="dt">double</span><span class="op">,</span> <span class="dt">double</span><span class="op">&gt;();</span></span>
<span id="cb24-54"><a href="#cb24-54" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</details><p>We can load this code, which is stored in <a href="(https://github.com/NOAA-FIMS/FIMS/blob/main/vignettes/cpp/my_polymorphism.cpp)" class="external-link"><code>cpp/my_polymorphism.cpp</code></a>
using <code><a href="https://rdrr.io/pkg/Rcpp/man/sourceCpp.html" class="external-link">Rcpp::sourceCpp()</a></code> and <code><a href="https://rdrr.io/pkg/Rcpp/man/loadModule.html" class="external-link">Rcpp::loadModule()</a></code>
where the second argument is <code>TRUE</code> so that all objects are
loaded into the R environment. <code><a href="https://rdrr.io/r/methods/new.html" class="external-link">methods::new()</a></code> is used to
create new instances of the desired class.</p>
<details><summary><strong>Example: Load module</strong>
</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/sourceCpp.html" class="external-link">sourceCpp</a></span><span class="op">(</span><span class="st">"cpp/my_polymorphism.cpp"</span><span class="op">)</span></span>
<span><span class="co"># Note that "shape" matches the name passed to RCPP_MODULE</span></span>
<span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/loadModule.html" class="external-link">loadModule</a></span><span class="op">(</span><span class="st">"shape"</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fu">methods</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="va">Circle</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">methods</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="va">Rectangle</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">c</span><span class="op">$</span><span class="fu">area</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 12.56637</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span><span class="op">$</span><span class="fu">area</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 12</span></span></code></pre>
</details>
</div>
</div>
<div class="section level3">
<h3 id="pointers-and-references">Pointers and References<a class="anchor" aria-label="anchor" href="#pointers-and-references"></a>
</h3>
<div class="section level4">
<h4 id="pointers">Pointers<a class="anchor" aria-label="anchor" href="#pointers"></a>
</h4>
<p>A <a href="https://www.w3schools.com/cpp/cpp_pointers.asp" class="external-link">pointer</a> is a
variable that stores the memory address of another variable as its
value. Instead of holding a direct value (like an int or double), a
pointer “points to” the location in memory where a value is stored.
Pointers are declared using the <code>*</code> operator, for example,
<code>int* p;</code> creates a pointer named <code>p</code> to an
integer. More specifically, to point to where <code>y</code> is stored
we can declare <code>int y = 3; int* x = &amp;y;</code>. The
<code>*</code> operator can also be used to access the value the pointer
points to, e.g., <code>*x</code>. Pointers are powerful for dynamic
memory management, working with arrays, and enabling efficient function
arguments. In FIMS, we use <a href="#shared-pointers">shared
pointer</a>, i.e., <code>std::shared_ptr&lt;int&gt; y</code>, which we
will explore later.</p>
<details><summary><strong>Example: Pointers</strong>
</summary><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html" class="external-link">cppFunction</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">#include &lt;Rcpp.h&gt;</span></span>
<span><span class="st">int pointer(){</span></span>
<span><span class="st">  float y = 3.1459;</span></span>
<span><span class="st">  //initiate a variable x that points to the same address as y</span></span>
<span><span class="st">  float* x = &amp;y;</span></span>
<span><span class="st">  Rcpp::Rcout &lt;&lt; "x is equal to the address of y" &lt;&lt; std::endl;</span></span>
<span><span class="st">  Rcpp::Rcout &lt;&lt; "x is: " &lt;&lt; x &lt;&lt; std::endl;</span></span>
<span><span class="st">  Rcpp::Rcout &lt;&lt;  "The address of y is: " &lt;&lt; &amp;y &lt;&lt; std::endl;</span></span>
<span><span class="st">  Rcpp::Rcout &lt;&lt; "*x returns the value of y: " &lt;&lt; *x &lt;&lt;  std::endl;</span></span>
<span><span class="st">  return 0;</span></span>
<span><span class="st">}'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">pointer</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## x is equal to the address of y</span></span>
<span><span class="co">## x is: 0x7fffa5d05de4</span></span>
<span><span class="co">## The address of y is: 0x7fffa5d05de4</span></span>
<span><span class="co">## *x returns the value of y: 3.1459</span></span></code></pre>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
</details>
</div>
<div class="section level4">
<h4 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h4>
<p>A <a href="https://www.w3schools.com/cpp/cpp_references.asp" class="external-link">reference
variable</a> is an alias for an existing variable. Once a reference is
initialized to a variable, it acts as another name for that variable —
any changes made through the reference affect the original variable.
References are declared using the <code>&amp;</code> operator, for
example: <code>int y = 3; int &amp;ref = y;</code> creates a reference
named <code>ref</code> that refers to the variable <code>y</code>.
Unlike pointers, references must be initialized when declared and cannot
be changed to refer to another variable later. References are commonly
used to pass variables to functions without making copies, enabling
efficient and direct access to the original data. The <code>&amp;</code>
operator can also be used to return the memory address of a variable,
e.g., <code>&amp;y</code>.</p>
<details><summary><strong>Example: References</strong>
</summary><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html" class="external-link">cppFunction</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">  #include &lt;Rcpp.h&gt;</span></span>
<span><span class="st">  int reference() {</span></span>
<span><span class="st">    int y = 3;</span></span>
<span><span class="st">    int &amp;x = y;</span></span>
<span><span class="st">    Rcpp::Rcout &lt;&lt; "x is: " &lt;&lt; x &lt;&lt; std::endl;</span></span>
<span><span class="st">    Rcpp::Rcout &lt;&lt; "y is: " &lt;&lt; y &lt;&lt; std::endl;</span></span>
<span><span class="st">    Rcpp::Rcout &lt;&lt; "The memory address of x is: " &lt;&lt; &amp;x &lt;&lt; std::endl;</span></span>
<span><span class="st">    Rcpp::Rcout &lt;&lt; "The memory address of y is: " &lt;&lt; &amp;y &lt;&lt; std::endl;</span></span>
<span><span class="st"></span></span>
<span><span class="st">    return 0;</span></span>
<span><span class="st">  }'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">reference</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## x is: 3</span></span>
<span><span class="co">## y is: 3</span></span>
<span><span class="co">## The memory address of x is: 0x7fffa5d05de4</span></span>
<span><span class="co">## The memory address of y is: 0x7fffa5d05de4</span></span></code></pre>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
</details>
</div>
<div class="section level4">
<h4 id="modifying-pointers">Modifying Pointers<a class="anchor" aria-label="anchor" href="#modifying-pointers"></a>
</h4>
<p>We can use pointers to update values. In the following example,
<code>b</code> is a copy while <code>c</code> is a pointer, which is why
<code>b</code> does not get updated when <code>*c</code> is updated. We
avoid copies in FIMS because when a variable gets updated in the model,
we want it updated everywhere in the model.</p>
<details><summary><strong>Example: Updating pointers</strong>
</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html" class="external-link">cppFunction</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">#include &lt;Rcpp.h&gt;</span></span>
<span><span class="st">int update_pointer(){</span></span>
<span><span class="st"> //initiate a variable</span></span>
<span><span class="st">  float a = 3.1459;</span></span>
<span><span class="st">  //initiate a new variable with the same value as a</span></span>
<span><span class="st">  float b = a;</span></span>
<span><span class="st">  //initiate a variable c that points to the same address as a</span></span>
<span><span class="st">  float* c = &amp;a;</span></span>
<span><span class="st">  *c = 100;</span></span>
<span><span class="st">  Rcpp::Rcout &lt;&lt; "a and *c have been updated; b has not"  &lt;&lt; std::endl;</span></span>
<span><span class="st">  Rcpp::Rcout &lt;&lt; "a = " &lt;&lt; a &lt;&lt; "; *c = " &lt;&lt; *c &lt;&lt; std::endl;</span></span>
<span><span class="st">  Rcpp::Rcout &lt;&lt; "b = " &lt;&lt; b &lt;&lt; std::endl;</span></span>
<span><span class="st">  return 0;</span></span>
<span><span class="st">}'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">update_pointer</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## a and *c have been updated; b has not</span></span>
<span><span class="co">## a = 100; *c = 100</span></span>
<span><span class="co">## b = 3.1459</span></span></code></pre>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
</details><p>We can reassign pointers using the <code>&amp;</code> operator. What
do you expect <code>a</code> and <code>*c</code> to return in the
following example?</p>
<details><summary><strong>Example: Reassigning pointers</strong>
</summary><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html" class="external-link">cppFunction</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">#include &lt;Rcpp.h&gt;</span></span>
<span><span class="st">int reassign_pointer(){</span></span>
<span><span class="st">//initiate a variable</span></span>
<span><span class="st">  float a = 3.1459;</span></span>
<span><span class="st">  //initiate a new variable with the same value as a</span></span>
<span><span class="st">  float b = a;</span></span>
<span><span class="st">  //initiate a variable c that points to the same address as a</span></span>
<span><span class="st">  float* c = &amp;a;</span></span>
<span><span class="st">  *c = 100;</span></span>
<span><span class="st">  c = &amp;b;</span></span>
<span><span class="st">  b = 10;</span></span>
<span><span class="st">  Rcpp::Rcout &lt;&lt; "c now equals the address of b" &lt;&lt; std::endl;</span></span>
<span><span class="st">  Rcpp::Rcout &lt;&lt; "&amp;a = " &lt;&lt; &amp;a &lt;&lt; std::endl;</span></span>
<span><span class="st">  Rcpp::Rcout &lt;&lt; "&amp;b = " &lt;&lt; &amp;b &lt;&lt; std::endl;</span></span>
<span><span class="st">  Rcpp::Rcout &lt;&lt; "c = " &lt;&lt; c &lt;&lt; std::endl;</span></span>
<span><span class="st">  Rcpp::Rcout &lt;&lt; "a = " &lt;&lt; a &lt;&lt; std::endl;</span></span>
<span><span class="st">  Rcpp::Rcout &lt;&lt; "b = " &lt;&lt; b &lt;&lt; std::endl;</span></span>
<span><span class="st">  Rcpp::Rcout &lt;&lt; "*c = " &lt;&lt; *c &lt;&lt;std::endl;</span></span>
<span><span class="st">  return 0;</span></span>
<span><span class="st">}'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">reassign_pointer</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## c now equals the address of b</span></span>
<span><span class="co">## &amp;a = 0x7fffa5d05de0</span></span>
<span><span class="co">## &amp;b = 0x7fffa5d05de4</span></span>
<span><span class="co">## c = 0x7fffa5d05de4</span></span>
<span><span class="co">## a = 100</span></span>
<span><span class="co">## b = 10</span></span>
<span><span class="co">## *c = 10</span></span></code></pre>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
</details>
</div>
<div class="section level4">
<h4 id="memory-management">Memory Management<a class="anchor" aria-label="anchor" href="#memory-management"></a>
</h4>
<p>When pointers are initialized inline, e.g.,
<code>int x = 3; int* y = x</code>, the compiler automatically creates
and manages memory for you. Care must be taken to manage memory
properly. The user can also create and manage memory themselves using
the <code>new</code> and <code>delete</code> commands. If you create a
variable using <code>new</code> and do not clean up after using
<code>delete</code>, the program can result in <strong>memory
leaks</strong> where the memory in the program accumulates over its run
time, which can slow down or even crash your program. In FIMS, we use
<code>clear()</code>, which removes all pointers, references, and
objects created during previous model runs, ensuring that no leftover
data or memory remains in the C++ backend. This is important for
avoiding memory leaks and for making sure that each new model run starts
with a clean slate. In practice, you should run clear() before starting
a new model or after finishing one, especially when working
interactively in R, to prevent old objects from interfering with new
analyses.</p>
<details><summary><strong>Example: Manual memory management</strong>
</summary><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html" class="external-link">cppFunction</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">#include &lt;Rcpp.h&gt;</span></span>
<span><span class="st">int manage_memory(){</span></span>
<span><span class="st">  //initiate an integer type pointer</span></span>
<span><span class="st">  int* ptr= new int;</span></span>
<span><span class="st">  *ptr = 35;</span></span>
<span><span class="st">  Rcpp::Rcout &lt;&lt; "*ptr = " &lt;&lt; *ptr &lt;&lt;std::endl;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  //delete memory</span></span>
<span><span class="st">  delete ptr;</span></span>
<span><span class="st">  return 0;</span></span>
<span><span class="st">}'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">manage_memory</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## *ptr = 35</span></span></code></pre>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
</details>
</div>
</div>
<div class="section level3">
<h3 id="shared-pointers">Shared pointers<a class="anchor" aria-label="anchor" href="#shared-pointers"></a>
</h3>
<p>A <a href="https://www.geeksforgeeks.org/cpp/shared_ptr-in-cpp/" class="external-link">shared
pointers</a>, also called a smart pointer, in C++ is a type of smart
pointer provided by the standard library (<code>std::shared_ptr</code>)
that manages the lifetime of a dynamically allocated object. Unlike a
regular pointer, a shared pointer keeps track of how many shared
pointers point to the same object using a reference count. When the last
shared pointer referencing an object is destroyed or reset, the object’s
memory is automatically deallocated. Shared pointers are especially
useful when multiple parts of a program need to share ownership of an
object, as they help prevent memory leaks and make memory management
safer and easier. In FIMS, shared pointers are used to ensure that
important model components are accessible from different modules while
avoiding manual memory management.</p>
<p>FIMS uses shared pointers to help with memory management. It is
recommended to use a shared pointer when the ownership of an object is
shared across the program. For example in FIMS, the recruitment module
needs to be accessed by information.hpp and population.hpp. The pointer
to the recruitment module, is therefore shared across the program. C++
automatically deallocates memory for a shared pointer when the object
goes out of scope, thus preventing memory leaks in the program.</p>
<p>Specifically, each shared pointer has a reference count that tracks
the number of instances in which the shared pointer points to the same
object. In the example above, information and population both reference
the recruitment module using a shared pointer, so the recruitment module
pointer would have a reference count of two. When the reference count
drops to zero, the memory where the recruitment module is saved would be
automatically deleted.</p>
<p>Declare a shared pointer:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="bu">std::</span>shared_ptr<span class="op">&lt;</span>Type<span class="op">&gt;</span> ptr<span class="op">;</span></span></code></pre></div>
<p>Initialize using a new pointer:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="bu">std::</span>shared_ptr<span class="op">&lt;</span>Type<span class="op">&gt;*</span> ptr<span class="op">;</span></span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a><span class="bu">std::</span>shared_ptr<span class="op">&lt;</span>Type<span class="op">&gt;</span> ptr <span class="op">=</span> <span class="bu">std::</span>make_shared<span class="op">&lt;</span>Type<span class="op">&gt;();</span></span></code></pre></div>
<p>Initialize using existing pointer:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="dt">double</span><span class="op">*</span> x <span class="op">=</span> <span class="fl">3.2</span><span class="op">;</span></span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a>shared_ptr<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> ptr<span class="op">(</span>x<span class="op">);</span></span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a>shared_ptr<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> ptr <span class="op">=</span> make_shared<span class="op">(</span>x<span class="op">);</span></span></code></pre></div>
<details><summary><strong>Example: Shared pointers</strong>
</summary><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html" class="external-link">cppFunction</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">  #include &lt;Rcpp.h&gt;</span></span>
<span><span class="st">  //std::shared_ptr is defined in &lt;memory&gt;</span></span>
<span><span class="st">  #include &lt;memory&gt;</span></span>
<span><span class="st">  int shared_pointer(){</span></span>
<span><span class="st">   // Creating shared pointers using std::make_shared</span></span>
<span><span class="st">    std::shared_ptr&lt;int&gt; ptr1 = std::make_shared&lt;int&gt;(42);</span></span>
<span><span class="st">    std::shared_ptr&lt;int&gt; ptr2 = std::make_shared&lt;int&gt;(24);</span></span>
<span><span class="st">    // Accessing the values using the (*) operator</span></span>
<span><span class="st">    Rcpp::Rcout &lt;&lt; "ptr1: " &lt;&lt; *ptr1 &lt;&lt; std::endl;</span></span>
<span><span class="st">    Rcpp::Rcout &lt;&lt; "ptr2: " &lt;&lt; *ptr2 &lt;&lt; std::endl;</span></span>
<span><span class="st">    // Set up a new pointer that shares ownership with the ptr1</span></span>
<span><span class="st">    std::shared_ptr&lt;int&gt; ptr3 = ptr1;</span></span>
<span><span class="st">    // Checking if shared pointer 1 and shared pointer 3</span></span>
<span><span class="st">    Rcpp::Rcout &lt;&lt; "ptr1 = " &lt;&lt; ptr1 &lt;&lt; std::endl;</span></span>
<span><span class="st">    Rcpp::Rcout &lt;&lt; "ptr2 = " &lt;&lt; ptr2 &lt;&lt; std::endl;</span></span>
<span><span class="st">    Rcpp::Rcout &lt;&lt; "ptr3 = " &lt;&lt; ptr3 &lt;&lt; std::endl;</span></span>
<span><span class="st"></span></span>
<span><span class="st">    return 0;</span></span>
<span><span class="st">}'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">shared_pointer</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ptr1: 42</span></span>
<span><span class="co">## ptr2: 24</span></span>
<span><span class="co">## ptr1 = 0x557e19c9f6b0</span></span>
<span><span class="co">## ptr2 = 0x557e1602f030</span></span>
<span><span class="co">## ptr3 = 0x557e19c9f6b0</span></span></code></pre>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
</details>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kelli F. Johnson, Jon K. T. Brodziak, Kathryn L. Doering, Andrea M. Havron, Ronald Klasky, Peter T. Kuriyama, Christopher M. Legault, Bai Li, Timothy J. Miller, Cole C. Monnahan, Megumi C. Oshima, Kyle W. Shertzer, Christine C. Stawitz, Jane Y. Sullivan, Matthew Supernaw, Ian G. Taylor, Nathan R. Vaughan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
