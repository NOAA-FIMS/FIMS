<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Intro to Rcpp • FIMS</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Intro to Rcpp">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&amp;display=swap" rel="stylesheet">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <img class="navlogo" src="https://noaa-fims.github.io/images/FIMS_logo3.png" width="60" align="left"><a class="navbar-brand me-2" href="../index.html">FIMS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/NOAA-FIMS/FIMS/releases/latest">Latest release</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reports">
<li><a class="dropdown-item" href="../coverage/coverage.html">coverage</a></li>
    <li><a class="dropdown-item" href="../coverage/codecoverage_explanation.html">coverage explained</a></li>
    <li><a class="dropdown-item" href="../testdown/index.html">testdown</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://noaa-fims.github.io/">fims website</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/noaa-fims/fims/" aria-label="GitHub repository for FIMS"><span class="fa fa-brands fa-github fa-lg"></span></a></li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Intro to Rcpp</h1>
                        <h4 data-toc-skip class="author">Christine
Stawitz</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/noaa-fims/fims/blob/main/vignettes/training-intro-rcpp.Rmd" class="external-link"><code>vignettes/training-intro-rcpp.Rmd</code></a></small>
      <div class="d-none name"><code>training-intro-rcpp.Rmd</code></div>
    </div>

    
    
<!-- The section below creates a collpase/expand all button -->
<div id="expand-collapse-buttons" style="margin-bottom: 20px;">
<p><button onclick="expandAll()" class="btn btn-primary">Expand
All</button>
<button onclick="collapseAll()" class="btn btn-secondary">Collapse
All</button></p>
</div>
<script>
function expandAll() {
  const details = document.querySelectorAll('details');
  details.forEach((detail) => {
    detail.setAttribute('open', 'true');
  });
}

function collapseAll() {
  const details = document.querySelectorAll('details');
  details.forEach((detail) => {
    detail.removeAttribute('open');
  });
}
</script><div class="section level2">
<h2 id="what-is-rcpp">What is Rcpp<a class="anchor" aria-label="anchor" href="#what-is-rcpp"></a>
</h2>
<div class="section level3">
<h3 id="definition">Definition<a class="anchor" aria-label="anchor" href="#definition"></a>
</h3>
<p><a href="https://cran.r-project.org/package=Rcpp" class="external-link">Rcpp</a> is an <a href="https://www.r-project.org/" class="external-link">R</a> package that facilitates
seamless integration of R and <a href="https://cplusplus.com/" class="external-link">C++</a>
code. By providing tools and classes within this R package, users can
easily write high-performance C++ functions and use them directly in R,
which allows users to combine R’s statistical capabilities with the
speed and flexibility of C++.</p>
<p>Rcpp acts as an Application Programming Interface (API) between R and
C++. As an API, Rcpp defines a set of tools and conventions that enable
R and C++ code to communicate and work together seamlessly, making it
easy to call C++ functions from R and exchange data between the two
languages.</p>
</div>
<div class="section level3">
<h3 id="why-use-rcpp">Why use Rcpp<a class="anchor" aria-label="anchor" href="#why-use-rcpp"></a>
</h3>
<p>There are other options out there besides Rcpp, e.g., <a href="https://cran.r-project.org/package=cpp11" class="external-link">cpp11</a> and <a href="https://cran.r-project.org/package=cpp4r" class="external-link">cpp4r</a>. We choose to
use Rcpp because</p>
<ul>
<li>Rcpp is one of the most widely used R extensions (i.e., over 1000
packages),</li>
<li>With very minimal knowledge of C++, Rcpp facilitates increasing the
speed of functions, and</li>
<li>The most efficient R functions are written in C++ and called from
R.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="writing-cpp-functions">Writing C++ functions<a class="anchor" aria-label="anchor" href="#writing-cpp-functions"></a>
</h2>
<div class="section level3">
<h3 id="inline-c-code-in-r">Inline C++ code in R<a class="anchor" aria-label="anchor" href="#inline-c-code-in-r"></a>
</h3>
<p>Using {Rcpp} you can compile C++ code using R and never have to
interact with an external file or compiler using one of the two
following functions:</p>
<ul>
<li>You can write C++ functions inline in your R code by wrapping the
C++ code in <code><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html" class="external-link">Rcpp::cppFunction()</a></code>.</li>
<li>You can compile and execute single lines of code directly using
<code><a href="https://rdrr.io/pkg/Rcpp/man/evalCpp.html" class="external-link">Rcpp::evalCpp()</a></code>.</li>
</ul>
<details><summary><strong>Example: Inline C++ within R</strong>
</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.rcpp.org" class="external-link">Rcpp</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compile inline C++ using R</span></span>
<span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html" class="external-link">cppFunction</a></span><span class="op">(</span><span class="st">"int add(int x, int y, int z) {</span></span>
<span><span class="st">  int sum = x + y + z;</span></span>
<span><span class="st">  return sum;</span></span>
<span><span class="st">}"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># after compiling, add works like a regular R function</span></span>
<span><span class="va">add</span></span></code></pre></div>
<pre><code><span><span class="co">## function (x, y, z) </span></span>
<span><span class="co">## .Call(&lt;pointer: 0x7fcedf3d4530&gt;, x, y, z)</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">add</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 6</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compile and execute C++ code</span></span>
<span><span class="co"># Find the square root of 16</span></span>
<span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/evalCpp.html" class="external-link">evalCpp</a></span><span class="op">(</span><span class="st">"std::sqrt(16.0)"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Return the largest representable double value</span></span>
<span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/evalCpp.html" class="external-link">evalCpp</a></span><span class="op">(</span><span class="st">"std::numeric_limits&lt;double&gt;::max()"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1.797693e+308</span></span></code></pre>
</details>
</div>
<div class="section level3">
<h3 id="calling--cpp-files-from-r">Calling .cpp files from R<a class="anchor" aria-label="anchor" href="#calling--cpp-files-from-r"></a>
</h3>
<p>You can save your C++ code in a separate file with the .cpp extension
and call this file from R using <code><a href="https://rdrr.io/pkg/Rcpp/man/sourceCpp.html" class="external-link">Rcpp::sourceCpp()</a></code>. For
example, the code below stores <code>meanC</code>, a C++ function that
calculates the mean of a numeric vector. This code can be saved in a
.cpp file, e.g., <code>mean.cpp</code> and compiled within your R
session with <code>Rcpp::sourceCpp("mean.cpp")</code>. Again, if you do
not want to use external cpp files, you can wrap the C++ code in quotes
and store it as an R object like the example above. Either way, the C++
is then made available within the R session using
<code><a href="https://rdrr.io/pkg/Rcpp/man/sourceCpp.html" class="external-link">Rcpp::sourceCpp()</a></code>. Both methods are illustrated below.</p>
<details><summary><strong>Example: mean.cpp</strong>
</summary><div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co"> The include statement allows you to use the Rcpp library in Rcpp.h, which</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co"> includes NumericVector.</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co"> You can use Rcpp functions like NumericVector without specifying their</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co"> namespace on each instance if you include the  entire Rcpp namespace using the</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co"> line below, e.g., you can use `NumericVector` rather than</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co"> `Rcpp::NumericVector`.</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp<span class="op">;</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co"> Use Rcpp::export to export the following function to R</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="dt">double</span> meanC<span class="op">(</span>NumericVector x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>  <span class="co">/*</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="co">   .size() is a member function of Rcpp::NumericVector class and can be accessed</span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co">   with the dot operator from any Rcpp::NumericVector object</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="co">  */</span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>  <span class="dt">int</span> n <span class="op">=</span> x<span class="op">.</span>size<span class="op">();</span></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>  <span class="dt">double</span> total <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a>    <span class="co">/*</span></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a><span class="co">     += is the same as x = x + y, and is known as an overload operator</span></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a>    total <span class="op">+=</span> x<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a>  <span class="cf">return</span> total <span class="op">/</span> n<span class="op">;</span></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</details><details><summary><strong>Example: Sourcing C++ Code in R</strong>
</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># code can be saved in .cpp file and compiled</span></span>
<span><span class="co"># Rcpp::sourceCpp("mean.cpp")</span></span>
<span><span class="co"># meanC(1:10)</span></span>
<span></span>
<span><span class="co"># The same code that is stored in mean.cpp can be sourced directly</span></span>
<span><span class="va">src</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"#include &lt;Rcpp.h&gt;</span></span>
<span><span class="st">using namespace Rcpp;</span></span>
<span><span class="st"></span></span>
<span><span class="st">// [[Rcpp::export]]</span></span>
<span><span class="st">double meanC(NumericVector x) {</span></span>
<span><span class="st">  int n = x.size();</span></span>
<span><span class="st">  double total = 0;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  for (int i = 0; i &lt; n; ++i) {</span></span>
<span><span class="st">    total += x[i];</span></span>
<span><span class="st">  }</span></span>
<span><span class="st">  return total / n;</span></span>
<span><span class="st">}</span></span>
<span><span class="st">"</span></span>
<span><span class="co"># compile the text</span></span>
<span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/sourceCpp.html" class="external-link">sourceCpp</a></span><span class="op">(</span>code <span class="op">=</span> <span class="va">src</span><span class="op">)</span></span>
<span><span class="fu">meanC</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 5.5</span></span></code></pre>
</details>
</div>
<div class="section level3">
<h3 id="benchmarking-against-r">Benchmarking against R<a class="anchor" aria-label="anchor" href="#benchmarking-against-r"></a>
</h3>
<p>Compiled C++ is often much faster than R. Below we compare our
compiled <code>meanC</code> function against the R function
<code>mean</code> using <a href="https://cran.r-project.org/package=microbenchmark" class="external-link">{microbenchmark}</a>.</p>
<details><summary><strong>Example: Benchmarking R vs C++</strong>
</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/" class="external-link">microbenchmark</a></span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1e5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  <span class="fu">meanC</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Unit: microseconds</span></span>
<span><span class="co">##      expr     min      lq     mean   median      uq      max neval</span></span>
<span><span class="co">##   mean(x) 421.898 430.514 436.4777 434.7120 440.793   508.65   100</span></span>
<span><span class="co">##  meanC(x) 371.364 371.624 480.4295 372.4905 380.771 10795.99   100</span></span></code></pre>
</details>
</div>
<div class="section level3">
<h3 id="c-in-fims">C++ in FIMS<a class="anchor" aria-label="anchor" href="#c-in-fims"></a>
</h3>
<p>In FIMS, most of the C++ code is organized into several header files
that are stored in the <a href="https://github.com/NOAA-FIMS/FIMS/tree/main/inst/include" class="external-link"><code>inst/include/</code></a>
directory. These files include the definitions of Rcpp modules and
interfaces (in inst/include/interface/rcpp/*) that make C++ classes and
functions accessible from R.</p>
<p>A single C++ source file (i.e., <a href="https://github.com/NOAA-FIMS/FIMS/blob/main/src/FIMS.cpp" class="external-link">src/FIMS.cpp</a>)
lists all of the header files and serves as their main entry point for
compilation. The build process is managed by the <a href="https://github.com/NOAA-FIMS/FIMS/blob/main/src/Makevars" class="external-link"><code>src/Makevars</code>
file</a> (and <a href="https://github.com/NOAA-FIMS/FIMS/blob/main/src/Makevars.win" class="external-link"><code>src/Makevars.win</code></a>
for Windows machines), which sets the necessary compiler and linker
flags for R to compile the C++ code into a shared library (DLL or SO).
This shared library is automatically loaded by R when users call
<code><a href="https://github.com/noaa-fims/fims" class="external-link">library(FIMS)</a></code>, allowing R users to call high-performance
C++ code without needing to use <code><a href="https://rdrr.io/pkg/Rcpp/man/sourceCpp.html" class="external-link">Rcpp::sourceCpp()</a></code>
manually.</p>
</div>
</div>
<div class="section level2">
<h2 id="rcpp-types">Rcpp Types<a class="anchor" aria-label="anchor" href="#rcpp-types"></a>
</h2>
<p>Rcpp types map standard C++ data types to R objects enabling seamless
data exchange and operations between R and C++ for efficiency. Example
Rcpp types include classes like <code>NumericVector</code> and
<code>IntegerVector</code>. Rcpp types handle everything from basic data
to complex structures like matrices, lists, and functions. Additionally,
each type handles memory management for you automatically.</p>
<div class="section level3">
<h3 id="rcpp-scalar-classes">Rcpp scalar classes<a class="anchor" aria-label="anchor" href="#rcpp-scalar-classes"></a>
</h3>
<ul>
<li>Integer: <code>int</code>
</li>
<li>Double: <code>double</code>
</li>
<li>Boolean: <code>bool</code>
</li>
<li>String: <code>String</code>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="rcpp-vector-classes">Rcpp vector classes<a class="anchor" aria-label="anchor" href="#rcpp-vector-classes"></a>
</h3>
<ul>
<li>Vector of integers: <code>IntegerVector</code>
</li>
<li>Vector of doubles: <code>NumericVector</code>
</li>
<li>Vector of booleans: <code>LogicalVector</code>
</li>
<li>Vector of strings: <code>CharacterVector</code>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="rcpp-methods">Rcpp methods<a class="anchor" aria-label="anchor" href="#rcpp-methods"></a>
</h3>
<p>Rcpp methods are functions that belong to Rcpp classes and allow you
to interact with C++ objects from R in an object-oriented way.</p>
<ul>
<li>Static methods are called using <code>::</code> on a class. For
example, <code>NumericVector::create()</code> creates a numeric vector
without needing an existing object.</li>
<li>Member methods (or member functions) are called on specific objects
using the <code>$</code> operator in R and the dot operator in C++. For
example, the <code>.size()</code> member function of the
<code>NumericVector</code> class returns the number of elements in the
<code>Rcpp::NumericVector</code> class. If you have any experience with
Python, it’s somewhat similar to the way you use dot notation
there.</li>
</ul>
<details><summary><strong>Example: Rcpp Vectors and Methods</strong>
</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">src</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"#include &lt;Rcpp.h&gt;</span></span>
<span><span class="st">  using namespace Rcpp;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  // [[Rcpp::export]]</span></span>
<span><span class="st">  NumericVector fun() {</span></span>
<span><span class="st">    //Call static methods on NumericVector</span></span>
<span><span class="st">    //Create new vector of size 3 using numbers 1, 2, and 3</span></span>
<span><span class="st">    NumericVector v = NumericVector::create(1, 2, 3);</span></span>
<span><span class="st">    Rcout &lt;&lt; NumericVector::get_na() &lt;&lt; std::endl;</span></span>
<span><span class="st"></span></span>
<span><span class="st">    //Call member methods on object v of class NumericVector</span></span>
<span><span class="st">    //Print the length of v</span></span>
<span><span class="st">    Rcout &lt;&lt; v.size() &lt;&lt; std::endl;</span></span>
<span><span class="st">    //append the number 4 to the vector using push_back()</span></span>
<span><span class="st">    v.push_back(4);</span></span>
<span><span class="st"></span></span>
<span><span class="st">    return v;</span></span>
<span><span class="st">  }</span></span>
<span><span class="st">"</span></span>
<span></span>
<span><span class="co"># Compile the code and call it</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/sourceCpp.html" class="external-link">sourceCpp</a></span><span class="op">(</span>code <span class="op">=</span> <span class="va">src</span><span class="op">)</span></span>
<span><span class="fu">fun</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## nan</span></span>
<span><span class="co">## 3</span></span></code></pre>
<pre><code><span><span class="co">## [1] 1 2 3 4</span></span></code></pre>
</details>
</div>
</div>
<div class="section level2">
<h2 id="rcpp-modules">Rcpp modules<a class="anchor" aria-label="anchor" href="#rcpp-modules"></a>
</h2>
<p><a href="https://cran.r-project.org/web/packages/Rcpp/vignettes/Rcpp-modules.pdf" class="external-link">Rcpp
modules</a> are a feature of the Rcpp package that allow you to expose
C++ classes, methods, and functions to R in a structured and
object-oriented way. This makes it possible to work with C++ objects
directly from R, enabling more advanced and efficient workflows that
combine the strengths of both languages. A module is defined in C++
using the <code>RCPP_MODULE</code> macro.</p>
<p>By using modules, you avoid the need to write low-level interface
code for each function or class you want to expose. Instead, you
describe the interface in a concise and readable way, and Rcpp handles
the details of data conversion and method dispatch.</p>
<div class="section level3">
<h3 id="rcpp_module">RCPP_MODULE<a class="anchor" aria-label="anchor" href="#rcpp_module"></a>
</h3>
<p>Rcpp modules can be used to expose C++ functions and classes using
the Rcpp macro <code>RCPP_MODULE</code>. Without
<code>RCPP_MODULE</code> the C++ that you want to call within R would
have to be extremely complex to work within the R environment. Much of
the complexity of changing R input (SEXP) into C++ types is handled by
including <code>#include &lt;Rcpp.h&gt;</code> but
<code>RCPP_MODULE</code> handles some additional complexity.</p>
<p>Within a module, you can register the following components:</p>
<ul>
<li>Constructors: These specify how to create new instances of a C++
class from R, mapping R arguments to C++ constructors.</li>
<li>Fields: These are member variables of a class that you want to make
accessible from R. You can expose them as read/write or read-only.</li>
<li>Methods: These are member functions of a class that can be called
from R, allowing you to invoke C++ logic on your objects.</li>
<li>Properties: These are similar to fields but can have custom getter
and setter functions, providing more control over how R interacts with
the underlying C++ data.</li>
</ul>
<p>Thus, <code>RCPP_MODULE</code>s can include <code>.field</code>,
<code>.constructor</code>, <code>.method</code>, and
<code>.property</code> arguments, where <code>.field</code> can be used
with two or three arguments. For example, the class that we create below
called <code>Uniform</code> is complex with a constructor; two inputs,
<code>min</code> and <code>max</code>; and one method,
<code>draw</code>. Additionally, classes can include
<code>.field_readonly</code>, which prevents it from being modified
within R.</p>
<details><summary><strong>Example: Rcpp Module Skeleton</strong>
</summary><div class="sourceCode" id="cb17"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>RCPP_MODULE<span class="op">(</span>unif_module<span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="va">class_</span><span class="op">&lt;</span>Uniform<span class="op">&gt;(</span><span class="st">"Uniform"</span><span class="op">)</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="op">.</span>constructor<span class="op">&lt;</span><span class="dt">double</span><span class="op">,</span><span class="dt">double</span><span class="op">&gt;()</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  <span class="op">.</span>field<span class="op">(</span><span class="st">"min"</span><span class="op">,</span> <span class="op">&amp;</span>Uniform<span class="op">::</span>min<span class="op">,</span> <span class="st">"minimum value"</span><span class="op">)</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>  <span class="op">.</span>field<span class="op">(</span><span class="st">"max"</span><span class="op">,</span> <span class="op">&amp;</span>Uniform<span class="op">::</span>max<span class="op">,</span> <span class="st">"maximum value"</span><span class="op">)</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>  <span class="op">.</span>method<span class="op">(</span><span class="st">"draw"</span><span class="op">,</span> <span class="op">&amp;</span>Uniform<span class="op">::</span>draw<span class="op">);</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</details>
</div>
<div class="section level3">
<h3 id="rcpp_exposed_class">RCPP_EXPOSED_CLASS<a class="anchor" aria-label="anchor" href="#rcpp_exposed_class"></a>
</h3>
<p>Rcpp provides several built-in types, such as
<code>Rcpp::NumericVector</code>, but when you define your own C++
class, you need to make Rcpp aware of it. This is done using the <a href="https://cran.r-project.org/web/packages/Rcpp/vignettes/Rcpp-extending.pdf" class="external-link"><code>RCPP_EXPOSED_CLASS</code></a>
macro. For example, if you create a new class called
<code>FancyVector</code>, you need add
<code>RCPP_EXPOSED_CLASS(FancyVector)</code> to your code. This macro
instructs Rcpp to generate the necessary type information, allowing your
new class to be used within Rcpp modules. As a result, you can pass
objects of your class between R and C++, store them in Rcpp containers,
and use them as arguments or return values in Rcpp-exposed
functions.</p>
</div>
<div class="section level3">
<h3 id="modules-in-fims">Modules in FIMS<a class="anchor" aria-label="anchor" href="#modules-in-fims"></a>
</h3>
<p>Within FIMS, we first use <code>RCPP_EXPOSED_CLASS()</code> to expose
all of our new type classes, e.g.,
<code>RCPP_EXPOSED_CLASS(Parameter)</code> in <a href="https://github.com/NOAA-FIMS/FIMS/blob/main/src/fims_modules.hpp" class="external-link"><code>src/fims_modules.hpp</code></a>.
Once all of the type classes are exposed, we then use a single instance
of <code>RCPP_MODULE</code> to expose the C++ to R in that same
file.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kelli F. Johnson, Jon K. T. Brodziak, Kathryn L. Doering, Andrea M. Havron, Ronald Klasky, Peter T. Kuriyama, Christopher M. Legault, Bai Li, Timothy J. Miller, Cole C. Monnahan, Megumi C. Oshima, Kyle W. Shertzer, Christine C. Stawitz, Jane Y. Sullivan, Matthew Supernaw, Ian G. Taylor, Nathan R. Vaughan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
