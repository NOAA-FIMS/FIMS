<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introducing the FIMS Logging System • FIMS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Introducing the FIMS Logging System">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">FIMS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/NOAA-FIMS/FIMS/releases/tag/v0.1.0">Version 0.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/noaa-fims/fims/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introducing the FIMS Logging System</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/noaa-fims/fims/blob/v0.3.0/vignettes/fims-logging.Rmd" class="external-link"><code>vignettes/fims-logging.Rmd</code></a></small>
      <div class="d-none name"><code>fims-logging.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="importance-of-logging">Importance of Logging<a class="anchor" aria-label="anchor" href="#importance-of-logging"></a>
</h2>
<p>Logging in FIMS is important because it allows developers to
understand what is happening within a model. It is especially useful
when problems arise. The FIMS logging system has been designed to handle
common issues, such as undefined modules, dimension issues, and software
errors that may occur when a model is not properly defined. This logging
system is accessible from both R and C++ and messages are provided using
a JSON format.</p>
</div>
<div class="section level2">
<h2 id="how-fims-logging-works">How FIMS Logging works<a class="anchor" aria-label="anchor" href="#how-fims-logging-works"></a>
</h2>
<p>At run time, logging messages are stored in a C++ structure called
LogEntry in inst/include/common/def.hpp. This structure contains useful
information, such as information regarding when the LogEntry was created
and what portion of the code initiated its creation. For details
regarding the contents of a LogEntry see the doxygen documentation. All
of the LogEntry(s) are stored in a log file that can be accessed from
within your R environment or written to the disk. Additionally, this
file can automatically be written to the disk when R fails to
successfully communicate with C++.</p>
</div>
<div class="section level2">
<h2 id="backend-c-specification">Backend C++ Specification<a class="anchor" aria-label="anchor" href="#backend-c-specification"></a>
</h2>
<p>The logging system (specified in inst/include/common/def.hpp)
provides three useful macro functions for creating log entries,
<code>FIMS_INFO_LOG</code>, <code>FIMS_WARNING_LOG</code>, and
<code>FIMS_ERROR_LOG</code>. These macros take a single string value as
an argument, the rest is handled internally. Therefore, the developer
only needs to worry about specifying the message and the macros take
care of capturing all the other elements of the log entry. For example,
<code>FIMS_INFO_LOG</code> is used quite a bit in information.hpp to let
the user know that items were initialized appropriately. Developers can
specify the information contained within the string passed to the macro
to be generic or specific to values stored inside the C++ code. See
below for an example of a generic message that is completely specified
by the user and a more specific message that uses information stored
within C++ for part of the message. Also, note that the C++ function
<code>fims::to_string</code> converts a numeric value to a string,
making it additive to the message.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>FIMS_INFO_LOG<span class="op">(</span><span class="st">"Starting to initialize the fleet structures"</span><span class="op">)</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>FIMS_INFO_LOG<span class="op">(</span><span class="st">"Initializing fleet "</span> <span class="op">+</span> fims<span class="op">::</span>to_string<span class="op">(</span>f<span class="op">-&gt;</span>id<span class="op">))</span></span></code></pre></div>
<p>Below is a real-world example of a log entry that was created while
running a FIMS model due to <code>FIMS_INFO_LOG</code> within <a href="https://github.com/NOAA-FIMS/FIMS/blob/main/inst/include/common/information.hpp#L371" class="external-link">selectivity
in information.hpp</a>. The log entry specifies the line of the file
with the macro that led to the log entry. The screenshot below shows
what the user would see if this log entry were invoked.</p>
<p><img src="figures%2Fselectivity_logging_entry.png"></p>
<p>Additionally, if FIMS has been compiled with the
<code>-DFIMS_DEBUG</code> pre-processing macro, output from the
<code>FIMS_DEBUG_LOG</code> macro will also be available in the log
file, allowing developers a more interactive developing experience. The
output from this macro is turned off in the main branch, and thus, the
macro is not available to the typical user to stop debugging statements
from polluting the log file.</p>
</div>
<div class="section level2">
<h2 id="using-the-logging-system-in-r">Using the Logging System in R<a class="anchor" aria-label="anchor" href="#using-the-logging-system-in-r"></a>
</h2>
<p>The FIMS Logging System is also available from R, with a caveat!
Logging from R gives less information than logging from C++. When a log
entry originates from R, file, routine, and line information are absent.
Further implementations may rectify this issue. Below are examples of
adding log entries from R.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">log_info</span><span class="op">(</span><span class="st">"info entry from R script"</span><span class="op">)</span></span>
<span><span class="fu">log_warning</span><span class="op">(</span><span class="st">"warning entry from R script"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">error</span> <span class="op">&lt;-</span> <span class="fu">log_error</span><span class="op">(</span><span class="st">"error entry from R script"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## before call.after call.</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">get_log_errors</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "[\n{\n\"timestamp\" : \"Wed Jan  8 22:27:29 2025\",\n\"level\" : \"error\",\n\"message\" : \"error entry from R script\",\n\"id\" : \"0\",\n\"user\" : \"runner\",\n\"wd\" : \"/home/runner/work/FIMS/FIMS/vignettes\",\n\"file\" : \"/home/runner/work/FIMS/FIMS/vignettes/R_env\",\n\"routine\" : \"traceback: 44: .External(list(name = \\\"InternalFunction_invoke\\\", address = &lt;pointer: 0x5648066330e0&gt;, \\n        dll = list(name = \\\"Rcpp\\\", path = \\\"/home/runner/work/_temp/Library/Rcpp/libs/Rcpp.so\\\", \\n            dynamicLookup = TRUE, handle = &lt;pointer: 0x5648066b6e30&gt;, \\n            info = &lt;pointer: 0x5648057dfcf0&gt;, forceSymbols = FALSE), \\n        numParameters = -1L), &lt;pointer: 0x56480c8bde50&gt;, ...)\\n43: log_error(\\\"error entry from R script\\\")\\n42: eval(expr, envir)\\n41: eval(expr, envir)\\n40: withVisible(eval(expr, envir))\\n39: withCallingHandlers(code, message = function (cnd) \\n    {\\n        watcher$capture_plot_and_output()\\n        if (on_message$capture) {\\n            watcher$push(cnd)\\n        }\\n        if (on_message$silence) {\\n            invokeRestart(\\\"muffleMessage\\\")\\n        }\\n    }, warning = function (cnd) \\n    {\\n        if (getOption(\\\"warn\\\") &gt;= 2 || getOption(\\\"warn\\\") &lt; 0) {\\n            return()\\n        }\\n        watcher$capture_plot_and_output()\\n        if (on_warning$capture) {\\n            cnd &lt;- sanitize_call(cnd)\\n            watcher$push(cnd)\\n        }\\n        if (on_warning$silence) {\\n            invokeRestart(\\\"muffleWarning\\\")\\n        }\\n    }, error = function (cnd) \\n    {\\n        watcher$capture_plot_and_output()\\n        cnd &lt;- sanitize_call(cnd)\\n        watcher$push(cnd)\\n        switch(on_error, continue = invokeRestart(\\\"eval_continue\\\"), \\n            stop = invokeRestart(\\\"eval_stop\\\"), error = invokeRestart(\\\"eval_error\\\", \\n                cnd))\\n    })\\n38: eval(call)\\n37: eval(call)\\n36: with_handlers({\\n        for (expr in tle$exprs) {\\n            ev &lt;- withVisible(eval(expr, envir))\\n            watcher$capture_plot_and_output()\\n            watcher$print_value(ev$value, ev$visible, envir)\\n        }\\n        TRUE\\n    }, handlers)\\n35: doWithOneRestart(return(expr), restart)\\n34: withOneRestart(expr, restarts[[1L]])\\n33: withRestartList(expr, restarts[-nr])\\n32: doWithOneRestart(return(expr), restart)\\n31: withOneRestart(withRestartList(expr, restarts[-nr]), restarts[[nr]])\\n30: withRestartList(expr, restarts[-nr])\\n29: doWithOneRestart(return(expr), restart)\\n28: withOneRestart(withRestartList(expr, restarts[-nr]), restarts[[nr]])\\n27: withRestartList(expr, restarts)\\n26: withRestarts(with_handlers({\\n        for (expr in tle$exprs) {\\n            ev &lt;- withVisible(eval(expr, envir))\\n            watcher$capture_plot_and_output()\\n            watcher$print_value(ev$value, ev$visible, envir)\\n        }\\n        TRUE\\n    }, handlers), eval_continue = function() TRUE, eval_stop = function() FALSE, \\n        eval_error = function(cnd) {\\n            signalCondition(cnd)\\n            stop(cnd)\\n        })\\n25: evaluate::evaluate(...)\\n24: evaluate(code, envir = env, new_device = FALSE, keep_warning = if (is.numeric(options$warning)) TRUE else options$warning, \\n        keep_message = if (is.numeric(options$message)) TRUE else options$message, \\n        stop_on_error = if (is.numeric(options$error)) options$error else {\\n            if (options$error &amp;&amp; options$include) \\n                0L\\n            else 2L\\n        }, output_handler = knit_handlers(options$render, options))\\n23: in_dir(input_dir(), expr)\\n22: in_input_dir(evaluate(code, envir = env, new_device = FALSE, \\n        keep_warning = if (is.numeric(options$warning)) TRUE else options$warning, \\n        keep_message = if (is.numeric(options$message)) TRUE else options$message, \\n        stop_on_error = if (is.numeric(options$error)) options$error else {\\n            if (options$error &amp;&amp; options$include) \\n                0L\\n            else 2L\\n        }, output_handler = knit_handlers(options$render, options)))\\n21: eng_r(options)\\n20: block_exec(params)\\n19: call_block(x)\\n18: process_group(group)\\n17: withCallingHandlers(if (tangle) process_tangle(group) else process_group(group), \\n        error = function(e) if (xfun::pkg_available(\\\"rlang\\\", \\\"1.0.0\\\")) rlang::entrace(e))\\n16: xfun:::handle_error(withCallingHandlers(if (tangle) process_tangle(group) else process_group(group), \\n        error = function(e) if (xfun::pkg_available(\\\"rlang\\\", \\\"1.0.0\\\")) rlang::entrace(e)), \\n        function(loc) {\\n            setwd(wd)\\n            write_utf8(res, output %n% stdout())\\n            paste0(\\\"\\nQuitting from lines \\\", loc)\\n        }, if (labels[i] != \\\"\\\") sprintf(\\\" [%s]\\\", labels[i]), get_loc)\\n15: process_file(text, output)\\n14: knitr::knit(knit_input, knit_output, envir = envir, quiet = quiet)\\n13: rmarkdown::render(envir = globalenv(), ...)\\n12: (function (..., seed = NULL) \\n    {\\n        if (!is.null(seed)) {\\n            set.seed(seed)\\n            if (requireNamespace(\\\"htmlwidgets\\\", quietly = TRUE)) {\\n                htmlwidgets::setWidgetIdSeed(seed)\\n            }\\n        }\\n        options(knitr.graphics.rel_path = FALSE)\\n        rmarkdown::render(envir = globalenv(), ...)\\n    })(input = base::quote(\\\"/home/runner/work/FIMS/FIMS/vignettes/fims-logging.Rmd\\\"), \\n        output_file = base::quote(\\\"fims-logging.html\\\"), output_dir = base::quote(\\\"/tmp/RtmpN8pVCt/file1d0225c53dd/articles\\\"), \\n        intermediates_dir = base::quote(\\\"/tmp/RtmpN8pVCt\\\"), encoding = base::quote(\\\"UTF-8\\\"), \\n        seed = base::quote(1014L), output_format = base::quote(list(\\n            knitr = list(opts_knit = NULL, opts_chunk = list(dev = \\\"ragg_png\\\", \\n                dpi = 96L, fig.width = 7.29166666666667, fig.height = 4.50659250103008, \\n                fig.retina = 2L, dev.args = list(bg = NA), fig.ext = \\\"png\\\", \\n                other.parameters = list()), knit_hooks = NULL, opts_hooks = NULL, \\n                opts_template = NULL), pandoc = list(to = \\\"html\\\", \\n                from = \\\"markdown+autolink_bare_uris+tex_math_single_backslash\\\", \\n                args = c(\\\"--standalone\\\", \\\"--section-divs\\\", \\\"--template\\\", \\n                \\\"/tmp/RtmpN8pVCt/pkgdown-rmd-template-1d024f9527c8.html\\\", \\n                \\\"--highlight-style\\\", \\\"pygments\\\"), keep_tex = FALSE, \\n                latex_engine = \\\"pdflatex\\\", ext = NULL, convert_fun = NULL, \\n                lua_filters = c(\\\"/home/runner/work/_temp/Library/rmarkdown/rmarkdown/lua/pagebreak.lua\\\", \\n                \\\"/home/runner/work/_temp/Library/rmarkdown/rmarkdown/lua/latex-div.lua\\\"\\n                )), keep_md = FALSE, clean_supporting = FALSE, df_print = \\\"default\\\", \\n            pre_knit = function (...) \\n            {\\n                options(width = width)\\n                if (is.function(old_pre)) {\\n                    old_pre(...)\\n                }\\n            }, post_knit = function (...) \\n            {\\n                op(base(...), overlay(...))\\n            }, pre_processor = function (...) \\n            {\\n                op(base(...), overlay(...))\\n            }, intermediates_generator = function (original_input, \\n                intermediates_dir) \\n            {\\n                copy_render_intermediates(original_input, intermediates_dir, \\n                    !self_contained)\\n            }, post_processor = function (metadata, input_file, output_file, \\n                ...) \\n            {\\n                original_output_file &lt;- output_file\\n                output_file &lt;- overlay(metadata, input_file, output_file, \\n                    ...)\\n                if (!is.null(attr(output_file, \\\"post_process_original\\\"))) \\n                    base(metadata, input_file, original_output_file, \\n                      ...)\\n                base(metadata, input_file, output_file, ...)\\n            }, file_scope = NULL, on_exit = function () \\n            {\\n                if (is.function(base)) \\n                    base()\\n                if (is.function(overlay)) \\n                    overlay()\\n            })), output_options = base::quote(NULL), quiet = base::quote(TRUE))\\n11: (function (what, args, quote = FALSE, envir = parent.frame()) \\n    {\\n        if (!is.list(args)) \\n            stop(\\\"second argument must be a list\\\")\\n        if (quote) \\n            args &lt;- lapply(args, enquote)\\n        .Internal(do.call(what, args, envir))\\n    })(base::quote(function (..., seed = NULL) \\n    {\\n        if (!is.null(seed)) {\\n            set.seed(seed)\\n            if (requireNamespace(\\\"htmlwidgets\\\", quietly = TRUE)) {\\n                htmlwidgets::setWidgetIdSeed(seed)\\n            }\\n        }\\n        options(knitr.graphics.rel_path = FALSE)\\n        rmarkdown::render(envir = globalenv(), ...)\\n    }), base::quote(list(input = \\\"/home/runner/work/FIMS/FIMS/vignettes/fims-logging.Rmd\\\", \\n        output_file = \\\"fims-logging.html\\\", output_dir = \\\"/tmp/RtmpN8pVCt/file1d0225c53dd/articles\\\", \\n        intermediates_dir = \\\"/tmp/RtmpN8pVCt\\\", encoding = \\\"UTF-8\\\", \\n        seed = 1014L, output_format = list(knitr = list(opts_knit = NULL, \\n            opts_chunk = list(dev = \\\"ragg_png\\\", dpi = 96L, fig.width = 7.29166666666667, \\n                fig.height = 4.50659250103008, fig.retina = 2L, dev.args = list(\\n                    bg = NA), fig.ext = \\\"png\\\", other.parameters = list()), \\n            knit_hooks = NULL, opts_hooks = NULL, opts_template = NULL), \\n            pandoc = list(to = \\\"html\\\", from = \\\"markdown+autolink_bare_uris+tex_math_single_backslash\\\", \\n                args = c(\\\"--standalone\\\", \\\"--section-divs\\\", \\\"--template\\\", \\n                \\\"/tmp/RtmpN8pVCt/pkgdown-rmd-template-1d024f9527c8.html\\\", \\n                \\\"--highlight-style\\\", \\\"pygments\\\"), keep_tex = FALSE, \\n                latex_engine = \\\"pdflatex\\\", ext = NULL, convert_fun = NULL, \\n                lua_filters = c(\\\"/home/runner/work/_temp/Library/rmarkdown/rmarkdown/lua/pagebreak.lua\\\", \\n                \\\"/home/runner/work/_temp/Library/rmarkdown/rmarkdown/lua/latex-div.lua\\\"\\n                )), keep_md = FALSE, clean_supporting = FALSE, df_print = \\\"default\\\", \\n            pre_knit = function (...) \\n            {\\n                options(width = width)\\n                if (is.function(old_pre)) {\\n                    old_pre(...)\\n                }\\n            }, post_knit = function (...) \\n            {\\n                op(base(...), overlay(...))\\n            }, pre_processor = function (...) \\n            {\\n                op(base(...), overlay(...))\\n            }, intermediates_generator = function (original_input, \\n                intermediates_dir) \\n            {\\n                copy_render_intermediates(original_input, intermediates_dir, \\n                    !self_contained)\\n            }, post_processor = function (metadata, input_file, output_file, \\n                ...) \\n            {\\n                original_output_file &lt;- output_file\\n                output_file &lt;- overlay(metadata, input_file, output_file, \\n                    ...)\\n                if (!is.null(attr(output_file, \\\"post_process_original\\\"))) \\n                    base(metadata, input_file, original_output_file, \\n                      ...)\\n                base(metadata, input_file, output_file, ...)\\n            }, file_scope = NULL, on_exit = function () \\n            {\\n                if (is.function(base)) \\n                    base()\\n                if (is.function(overlay)) \\n                    overlay()\\n            }), output_options = NULL, quiet = TRUE)), envir = base::quote(&lt;environment&gt;), \\n        quote = base::quote(TRUE))\\n10: base::do.call(base::do.call, base::c(base::readRDS(\\\"/tmp/RtmpN8pVCt/callr-fun-1d0216c4cedb\\\"), \\n        base::list(envir = .GlobalEnv, quote = TRUE)), envir = .GlobalEnv, \\n        quote = TRUE)\\n9: base::saveRDS(base::do.call(base::do.call, base::c(base::readRDS(\\\"/tmp/RtmpN8pVCt/callr-fun-1d0216c4cedb\\\"), \\n       base::list(envir = .GlobalEnv, quote = TRUE)), envir = .GlobalEnv, \\n       quote = TRUE), file = \\\"/tmp/RtmpN8pVCt/callr-res-1d0249c3d384\\\", \\n       compress = FALSE)\\n8: base::withCallingHandlers({\\n       NULL\\n       base::saveRDS(base::do.call(base::do.call, base::c(base::readRDS(\\\"/tmp/RtmpN8pVCt/callr-fun-1d0216c4cedb\\\"), \\n           base::list(envir = .GlobalEnv, quote = TRUE)), envir = .GlobalEnv, \\n           quote = TRUE), file = \\\"/tmp/RtmpN8pVCt/callr-res-1d0249c3d384\\\", \\n           compress = FALSE)\\n       base::flush(base::stdout())\\n       base::flush(base::stderr())\\n       NULL\\n       base::invisible()\\n   }, error = function(e) {\\n       {\\n           callr_data &lt;- base::as.environment(\\\"tools:callr\\\")$`__callr_data__`\\n           err &lt;- callr_data$err\\n           if (FALSE) {\\n               base::assign(\\\".Traceback\\\", base::.traceback(4), envir = callr_data)\\n               utils::dump.frames(\\\"__callr_dump__\\\")\\n               base::assign(\\\".Last.dump\\\", .GlobalEnv$`__callr_dump__`, \\n                   envir = callr_data)\\n               base::rm(\\\"__callr_dump__\\\", envir = .GlobalEnv)\\n           }\\n           e &lt;- err$process_call(e)\\n           e2 &lt;- err$new_error(\\\"error in callr subprocess\\\")\\n           class &lt;- base::class\\n           class(e2) &lt;- base::c(\\\"callr_remote_error\\\", class(e2))\\n           e2 &lt;- err$add_trace_back(e2)\\n           cut &lt;- base::which(e2$trace$scope == \\\"global\\\")[1]\\n           if (!base::is.na(cut)) {\\n               e2$trace &lt;- e2$trace[-(1:cut), ]\\n           }\\n           base::saveRDS(base::list(\\\"error\\\", e2, e), file = base::paste0(\\\"/tmp/RtmpN8pVCt/callr-res-1d0249c3d384\\\", \\n               \\\".error\\\"))\\n       }\\n   }, interrupt = function(e) {\\n       {\\n           callr_data &lt;- base::as.environment(\\\"tools:callr\\\")$`__callr_data__`\\n           err &lt;- callr_data$err\\n           if (FALSE) {\\n               base::assign(\\\".Traceback\\\", base::.traceback(4), envir = callr_data)\\n               utils::dump.frames(\\\"__callr_dump__\\\")\\n               base::assign(\\\".Last.dump\\\", .GlobalEnv$`__callr_dump__`, \\n                   envir = callr_data)\\n               base::rm(\\\"__callr_dump__\\\", envir = .GlobalEnv)\\n           }\\n           e &lt;- err$process_call(e)\\n           e2 &lt;- err$new_error(\\\"error in callr subprocess\\\")\\n           class &lt;- base::class\\n           class(e2) &lt;- base::c(\\\"callr_remote_error\\\", class(e2))\\n           e2 &lt;- err$add_trace_back(e2)\\n           cut &lt;- base::which(e2$trace$scope == \\\"global\\\")[1]\\n           if (!base::is.na(cut)) {\\n               e2$trace &lt;- e2$trace[-(1:cut), ]\\n           }\\n           base::saveRDS(base::list(\\\"error\\\", e2, e), file = base::paste0(\\\"/tmp/RtmpN8pVCt/callr-res-1d0249c3d384\\\", \\n               \\\".error\\\"))\\n       }\\n   }, callr_message = function(e) {\\n       base::try(base::signalCondition(e))\\n   })\\n7: doTryCatch(return(expr), name, parentenv, handler)\\n6: tryCatchOne(expr, names, parentenv, handlers[[1L]])\\n5: tryCatchList(expr, names[-nh], parentenv, handlers[-nh])\\n4: doTryCatch(return(expr), name, parentenv, handler)\\n3: tryCatchOne(tryCatchList(expr, names[-nh], parentenv, handlers[-nh]), \\n       names[nh], parentenv, handlers[[nh]])\\n2: tryCatchList(expr, classes, parentenv, handlers)\\n1: base::tryCatch(base::withCallingHandlers({\\n       NULL\\n       base::saveRDS(base::do.call(base::do.call, base::c(base::readRDS(\\\"/tmp/RtmpN8pVCt/callr-fun-1d0216c4cedb\\\"), \\n           base::list(envir = .GlobalEnv, quote = TRUE)), envir = .GlobalEnv, \\n           quote = TRUE), file = \\\"/tmp/RtmpN8pVCt/callr-res-1d0249c3d384\\\", \\n           compress = FALSE)\\n       base::flush(base::stdout())\\n       base::flush(base::stderr())\\n       NULL\\n       base::invisible()\\n   }, error = function(e) {\\n       {\\n           callr_data &lt;- base::as.environment(\\\"tools:callr\\\")$`__callr_data__`\\n           err &lt;- callr_data$err\\n           if (FALSE) {\\n               base::assign(\\\".Traceback\\\", base::.traceback(4), envir = callr_data)\\n               utils::dump.frames(\\\"__callr_dump__\\\")\\n               base::assign(\\\".Last.dump\\\", .GlobalEnv$`__callr_dump__`, \\n                   envir = callr_data)\\n               base::rm(\\\"__callr_dump__\\\", envir = .GlobalEnv)\\n           }\\n           e &lt;- err$process_call(e)\\n           e2 &lt;- err$new_error(\\\"error in callr subprocess\\\")\\n           class &lt;- base::class\\n           class(e2) &lt;- base::c(\\\"callr_remote_error\\\", class(e2))\\n           e2 &lt;- err$add_trace_back(e2)\\n           cut &lt;- base::which(e2$trace$scope == \\\"global\\\")[1]\\n           if (!base::is.na(cut)) {\\n               e2$trace &lt;- e2$trace[-(1:cut), ]\\n           }\\n           base::saveRDS(base::list(\\\"error\\\", e2, e), file = base::paste0(\\\"/tmp/RtmpN8pVCt/callr-res-1d0249c3d384\\\", \\n               \\\".error\\\"))\\n       }\\n   }, interrupt = function(e) {\\n       {\\n           callr_data &lt;- base::as.environment(\\\"tools:callr\\\")$`__callr_data__`\\n           err &lt;- callr_data$err\\n           if (FALSE) {\\n               base::assign(\\\".Traceback\\\", base::.traceback(4), envir = callr_data)\\n               utils::dump.frames(\\\"__callr_dump__\\\")\\n               base::assign(\\\".Last.dump\\\", .GlobalEnv$`__callr_dump__`, \\n                   envir = callr_data)\\n               base::rm(\\\"__callr_dump__\\\", envir = .GlobalEnv)\\n           }\\n           e &lt;- err$process_call(e)\\n           e2 &lt;- err$new_error(\\\"error in callr subprocess\\\")\\n           class &lt;- base::class\\n           class(e2) &lt;- base::c(\\\"callr_remote_error\\\", class(e2))\\n           e2 &lt;- err$add_trace_back(e2)\\n           cut &lt;- base::which(e2$trace$scope == \\\"global\\\")[1]\\n           if (!base::is.na(cut)) {\\n               e2$trace &lt;- e2$trace[-(1:cut), ]\\n           }\\n           base::saveRDS(base::list(\\\"error\\\", e2, e), file = base::paste0(\\\"/tmp/RtmpN8pVCt/callr-res-1d0249c3d384\\\", \\n               \\\".error\\\"))\\n       }\\n   }, callr_message = function(e) {\\n       base::try(base::signalCondition(e))\\n   }), error = function(e) {\\n       NULL\\n       if (FALSE) {\\n           base::try(base::stop(e))\\n       }\\n       else {\\n           base::invisible()\\n       }\\n   }, interrupt = function(e) {\\n       NULL\\n       if (FALSE) {\\n           e\\n       }\\n       else {\\n           base::invisible()\\n       }\\n   })\\n\",\n\"line\" : \"-1\"\n}\n]"</span></span></code></pre>
<p>In the above example of an error level log entry, notice the R stack
trace in the routine field. Sometimes this may contain useful
information, but most of the time the stack trace is to large to capture
the root cause of the error. For that reason, it’s advised to make the
error message as detailed as possible when calling
<code>log_error(x)</code> from R. Note that the formatting is better
when written to a file rather than printed to the screen as is done
here.</p>
<div class="section level3">
<h3 id="fims-logging-functions-in-r">
<strong>FIMS Logging Functions in R</strong><a class="anchor" aria-label="anchor" href="#fims-logging-functions-in-r"></a>
</h3>
<p>There are several exported logging functions in the FIMS packages. To
find out more about each of the following functions, use
<code><a href="https://rdrr.io/r/methods/show.html" class="external-link">methods::show()</a></code> to view the documentation.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="st">"package:FIMS"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_log|log_"</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_bullets.html" class="external-link">cli_bullets</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## get_log</span></span></code></pre>
<pre><code><span><span class="co">## get_log_errors</span></span></code></pre>
<pre><code><span><span class="co">## get_log_module</span></span></code></pre>
<pre><code><span><span class="co">## get_log_warnings</span></span></code></pre>
<pre><code><span><span class="co">## log_error</span></span></code></pre>
<pre><code><span><span class="co">## log_info</span></span></code></pre>
<pre><code><span><span class="co">## log_warning</span></span></code></pre>
<pre><code><span><span class="co">## set_log_throw_on_error</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get documentation for log_error</span></span>
<span><span class="fu">methods</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/methods/show.html" class="external-link">show</a></span><span class="op">(</span><span class="va">log_error</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## internal C++ function &lt;0x56480c8bde50&gt;</span></span>
<span><span class="co">##     docstring : Adds a error entry to the log from the R environment.</span></span>
<span><span class="co">##     signature : void log_error(std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;)</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="example-of-fims-logging-from-r">Example of FIMS logging from R<a class="anchor" aria-label="anchor" href="#example-of-fims-logging-from-r"></a>
</h2>
<p>Assuming a model has already been defined in the object
<code>default_parameters</code>, below is an example of using the
logging system with FIMS in R.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">default_parameters</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/initialize_fims.html">initialize_fims</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_4_model</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/fit_fims.html">fit_fims</a></span><span class="op">(</span>optimize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Starting optimization ...</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Restarting optimizer 3 times to improve gradient.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Maximum gradient went from <span style="color: #0000BB;">0.00298</span> to <span style="color: #0000BB;">0.00117</span> after 3 steps.</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Finished optimization</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Finished sdreport</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> FIMS model version: <span style="color: #0000BB;">0.3.0.0</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Total run time was <span style="color: #0000BB;">0.79339</span> seconds</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Number of parameters: total=79, fixed_effects=79, and random_effects=0</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Maximum gradient= <span style="color: #0000BB;">0.00117</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Negative log likelihood (NLL):</span></span>
<span><span class="co">## <span style="color: #00BBBB;">•</span> Marginal NLL= <span style="color: #0000BB;">2146.10345</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">•</span> Total NLL= <span style="color: #0000BB;">2146.10345</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Terminal SB=</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the log as a string in JSON format and parse into a list</span></span>
<span><span class="va">log_str</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu">get_log</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span><span class="va">log_str</span>, <span class="st">"log.json"</span><span class="op">)</span></span>
<span><span class="va">log_json</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="va">log_str</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get log warnings only</span></span>
<span><span class="va">log_warnings_str</span> <span class="op">&lt;-</span> <span class="fu">get_log_warnings</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get log errors only</span></span>
<span><span class="va">log_errors_str</span> <span class="op">&lt;-</span> <span class="fu">get_log_errors</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get log entries from the information module</span></span>
<span><span class="va">information_log</span> <span class="op">&lt;-</span> <span class="fu">get_log_module</span><span class="op">(</span><span class="st">"information"</span><span class="op">)</span></span></code></pre></div>
<p>Another useful option is <code>set_throw_on_error()</code>. If this
option is set to TRUE, FIMS will abort immediately when an error occurs
and if <code>write_log(TRUE)</code> was previously called, the log file
will be written before FIMS terminates the session. Below is an example
of how to throw on error.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set_log_throw_on_error</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">log_error</span><span class="op">(</span><span class="st">"throwing now!"</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kelli F. Johnson, Jon K. T. Brodziak, Kathryn L. Doering, Andrea M. Havron, Ronald Klasky, Peter T. Kuriyama, Christopher M. Legault, Bai Li, Timothy J. Miller, Cole C. Monnahan, Megumi C. Oshima, Kyle W. Shertzer, Christine C. Stawitz, Jane Y. Sullivan, Matthew Supernaw, Ian G. Taylor, Nathan R. Vaughan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
